<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUMMA - Dashboard</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-info {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-role {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .user-role-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--bg-light);
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .nav-menu {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            color: var(--text-gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
            font-size: 0.9375rem;
        }

        .nav-item:hover {
            background: var(--bg-light);
            color: var(--primary);
        }

        .nav-item.active {
            background: #eff6ff;
            color: var(--primary);
            font-weight: 600;
            border-left: 3px solid var(--primary);
        }

        .nav-icon {
            font-size: 1.25rem;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .btn-logout {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-dark);
        }

        .btn-logout:hover {
            background: var(--border);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
        }

        .top-bar {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .content-area {
            padding: 2rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .dashboard-left {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .dashboard-right {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-gray);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .stat-change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Notifications */
        .notification-item {
            padding: 1rem;
            border-left: 3px solid var(--border);
            margin-bottom: 0.75rem;
            background: var(--bg-light);
            border-radius: 4px;
        }

        .notification-item.warning {
            border-left-color: var(--warning);
            background: #fffbeb;
        }

        .notification-item.danger {
            border-left-color: var(--danger);
            background: #fef2f2;
        }

        .notification-item.info {
            border-left-color: var(--primary);
            background: #eff6ff;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
        }

        .notification-text {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .notification-date {
            font-size: 0.75rem;
            color: var(--text-gray);
            margin-top: 0.5rem;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.9375rem;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            background: var(--bg-light);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-gray);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Form */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9375rem;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 100;
                transition: left 0.3s;
            }

            .sidebar.open {
                left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">S</div>
                    <span>SUMMA</span>
                </div>
            </div>

            <div class="user-info">
                <div class="user-name" id="userName">Jean Dupont</div>
                <div class="user-role" id="userCompany">Entreprise ABC</div>
                <div class="user-role-badge" id="userAccessLevel">Admin</div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" onclick="switchView('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Tableau de bord</span>
                </div>
                <div class="nav-item" onclick="switchView('tresorerie')">
                    <span class="nav-icon">üí∞</span>
                    <span>Tr√©sorerie</span>
                </div>
                <div class="nav-item" onclick="switchView('factures')">
                    <span class="nav-icon">üìÑ</span>
                    <span>Factures</span>
                </div>
                <div class="nav-item" onclick="switchView('planning')">
                    <span class="nav-icon">üìÖ</span>
                    <span>Planning</span>
                </div>
                <div class="nav-item" onclick="switchView('import')">
                    <span class="nav-icon">üìÅ</span>
                    <span>Import</span>
                </div>
                <div class="nav-item" onclick="switchView('alertes')">
                    <span class="nav-icon">üîî</span>
                    <span>Alertes</span>
                </div>
                <div class="nav-item" onclick="switchView('analyse')">
                    <span class="nav-icon">üìà</span>
                    <span>Analyse fiscale</span>
                </div>
                <div class="nav-item" onclick="switchView('espace-client')">
                    <span class="nav-icon">üë§</span>
                    <span>Espace client</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" onclick="handleLogout()">üö™ D√©connexion</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div class="page-title" id="pageTitle">Tableau de bord</div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span id="currentDate"></span>
                </div>
            </div>

            <div class="content-area">
                <!-- Dashboard View -->
                <div id="viewDashboard" class="view">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Tr√©sorerie</div>
                            <div class="stat-value" id="statTresorerie">‚Ç¨ 48,250</div>
                            <div class="stat-change positive">+12%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">√Ä recevoir</div>
                            <div class="stat-value" id="statRecevoir">‚Ç¨ 12,500</div>
                            <div class="stat-change">3 factures</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Revenus (mois)</div>
                            <div class="stat-value" id="statRevenus">‚Ç¨ 25,380</div>
                            <div class="stat-change positive">+8%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prochaine √©ch√©ance</div>
                            <div class="stat-value" style="font-size: 1.25rem;">21 Jan</div>
                            <div class="stat-change">TVA trimestrielle</div>
                        </div>
                    </div>

                    <!-- Main Dashboard Grid -->
                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Tr√©sorerie Chart -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">√âvolution de la tr√©sorerie</div>
                                    <select id="periodSelect" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                        <option value="7">7 jours</option>
                                        <option value="30">30 jours</option>
                                        <option value="90">90 jours</option>
                                    </select>
                                </div>
                                <div class="chart-container">
                                    <canvas id="tresorerieChart"></canvas>
                                </div>
                            </div>

                            <!-- Recent Transactions -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Derni√®res transactions</div>
                                    <button class="btn btn-outline" style="padding: 0.5rem 1rem;" onclick="switchView('tresorerie')">Voir tout</button>
                                </div>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Cat√©gorie</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentTransactions">
                                        <tr>
                                            <td>20 D√©c</td>
                                            <td>Virement client ABC</td>
                                            <td>Vente</td>
                                            <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 2,500</td>
                                        </tr>
                                        <tr>
                                            <td>19 D√©c</td>
                                            <td>Loyer bureau</td>
                                            <td>Charges</td>
                                            <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 1,200</td>
                                        </tr>
                                        <tr>
                                            <td>18 D√©c</td>
                                            <td>Facture fournisseur XYZ</td>
                                            <td>Achat</td>
                                            <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 850</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Notifications / Alertes -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Notifications</div>
                                </div>
                                <div id="notificationsList">
                                    <div class="notification-item danger">
                                        <div class="notification-title">‚ö†Ô∏è TVA √† payer</div>
                                        <div class="notification-text">D√©claration TVA T4 √† soumettre avant le 21 janvier</div>
                                        <div class="notification-date">Dans 2 jours</div>
                                    </div>
                                    <div class="notification-item warning">
                                        <div class="notification-title">üìÑ Facture en retard</div>
                                        <div class="notification-text">Client XYZ - Facture #1234 √©chue depuis 5 jours</div>
                                        <div class="notification-date">Aujourd'hui</div>
                                    </div>
                                    <div class="notification-item info">
                                        <div class="notification-title">üí° Conseil fiscal</div>
                                        <div class="notification-text">Optimisez vos charges d√©ductibles avant fin d'ann√©e</div>
                                        <div class="notification-date">Il y a 1 heure</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Stats -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©sum√© rapide</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Factures √©mises</span>
                                        <span style="font-weight: 600;">28</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Factures pay√©es</span>
                                        <span style="font-weight: 600; color: var(--success);">25</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>En attente</span>
                                        <span style="font-weight: 600; color: var(--warning);">3</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Taux de recouvrement</span>
                                        <span style="font-weight: 600;">89%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Espace Client View -->
                <div id="viewEspaceClient" class="view hidden">
                    <div class="card">
                        <div class="card-title" style="margin-bottom: 2rem;">Informations de l'entreprise</div>
                        
                        <form id="clientInfoForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Nom de l'entreprise</label>
                                    <input type="text" class="form-input" id="companyName" value="Entreprise ABC">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">SIRET</label>
                                    <input type="text" class="form-input" id="companySIRET" value="123 456 789 00012">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Forme juridique</label>
                                    <select class="form-select" id="companyType">
                                        <option value="SARL">SARL</option>
                                        <option value="SAS">SAS</option>
                                        <option value="EURL">EURL</option>
                                        <option value="SCI">SCI</option>
                                        <option value="Auto-entrepreneur">Auto-entrepreneur</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">R√©gime fiscal</label>
                                    <select class="form-select" id="fiscalRegime">
                                        <option value="IS">Imp√¥t sur les soci√©t√©s (IS)</option>
                                        <option value="IR">Imp√¥t sur le revenu (IR)</option>
                                        <option value="Micro">R√©gime micro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">TVA</label>
                                    <select class="form-select" id="tvaRegime">
                                        <option value="normale">R√©gime normal</option>
                                        <option value="simplifie">R√©gime simplifi√©</option>
                                        <option value="franchise">Franchise en base</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">P√©riodicit√© TVA</label>
                                    <select class="form-select" id="tvaPeriod">
                                        <option value="mensuelle">Mensuelle (le 21)</option>
                                        <option value="trimestrielle">Trimestrielle (le 24)</option>
                                        <option value="annuelle">Annuelle</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1rem;">
                                <label class="form-label">Adresse</label>
                                <input type="text" class="form-input" id="companyAddress" value="123 Rue de la R√©publique, 75001 Paris">
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" id="companyEmail" value="contact@entreprise-abc.fr">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√©l√©phone</label>
                                    <input type="tel" class="form-input" id="companyPhone" value="+33 1 23 45 67 89">
                                </div>
                            </div>

                            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                                <div class="card-title" style="margin-bottom: 1rem;">Informations bancaires</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">IBAN</label>
                                        <input type="text" class="form-input" id="companyIBAN" value="FR76 1234 5678 9012 3456 7890 123">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">BIC</label>
                                        <input type="text" class="form-input" id="companyBIC" value="BNPAFRPPXXX">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" style="margin-top: 2rem;">Enregistrer les modifications</button>
                        </form>
                    </div>

                    <!-- User Management (Admin only) -->
                    <div class="card" id="userManagementSection" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Gestion des utilisateurs</div>
                            <button class="btn btn-primary" onclick="showAddUserModal()">+ Ajouter un utilisateur</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Niveau d'acc√®s</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersList">
                                <tr>
                                    <td>Jean Dupont</td>
                                    <td><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c8a2ada9a6e6acbdb8a7a6bc88ada6bcbaadb8baa1bbade5a9aaabe6aeba">[email&#160;protected]</a></td>
                                    <td><span class="badge badge-success">Admin</span></td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Marie Martin</td>
                                    <td><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a4c9c5d6cdc18ac9c5d6d0cdcae4c1cad0d6c1d4d6cdd7c189c5c6c78ac2d6">[email&#160;protected]</a></td>
                                    <td><span class="badge badge-warning">Comptable</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="editUser(2)">Modifier</button></td>
                                </tr>
                                <tr>
                                    <td>Pierre Dubois</td>
                                    <td><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5828313d2a2a3d763c2d3a37312b183d362c2a3d282a312b3d75393a3b763e2a">[email&#160;protected]</a></td>
                                    <td><span class="badge">Consultation</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="editUser(3)">Modifier</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Planning View -->
                <div id="viewPlanning" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">T√¢ches en cours</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--primary);">8</div>
                            <div class="stat-change">3 urgentes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Compl√©t√©es (mois)</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--success);">24</div>
                            <div class="stat-change positive">+6 vs nov.</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">En retard</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--danger);">2</div>
                            <div class="stat-change negative">√Ä traiter</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prochaine √©ch√©ance</div>
                            <div class="stat-value" style="font-size: 1.25rem;">21 Jan</div>
                            <div class="stat-change">TVA T4</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Calendar View -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">üìÖ Calendrier - Janvier 2025</div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-outline" style="padding: 0.5rem 1rem;">‚Üê D√©c</button>
                                        <button class="btn btn-outline" style="padding: 0.5rem 1rem;">F√©v ‚Üí</button>
                                    </div>
                                </div>
                                
                                <!-- Simple Calendar -->
                                <div style="margin-top: 1rem;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Lun</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Mar</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Mer</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Jeu</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Ven</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Sam</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Dim</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); color: var(--text-gray);">30</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); color: var(--text-gray);">31</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); font-weight: 600;">1</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">2</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">3</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">4</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">5</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">6</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">7</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">8</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">9</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">10</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">11</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">12</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">13</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">14</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #fef3c7; font-weight: 600;">15<div style="font-size: 0.7rem; margin-top: 0.25rem;">üíº Salaires</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">16</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">17</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">18</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">19</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">20</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #fee2e2; font-weight: 600;">21<div style="font-size: 0.7rem; margin-top: 0.25rem;">üìä TVA</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">22</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">23</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">24</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">25</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">26</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">27</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">28</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #eff6ff; font-weight: 600;">29<div style="font-size: 0.7rem; margin-top: 0.25rem;">ü§ù RDV Expert</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">30</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #fef2f2; font-weight: 600;">31<div style="font-size: 0.7rem; margin-top: 0.25rem;">üìÅ Cl√¥ture</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light); color: var(--text-gray);">1</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light); color: var(--text-gray);">2</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 8px; display: flex; gap: 1.5rem; font-size: 0.875rem;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 16px; height: 16px; background: #fee2e2; border-radius: 4px;"></div>
                                        <span>Urgent</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 16px; height: 16px; background: #fef3c7; border-radius: 4px;"></div>
                                        <span>Important</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 16px; height: 16px; background: #eff6ff; border-radius: 4px;"></div>
                                        <span>Normal</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Task List -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">üìã T√¢ches</div>
                                    <button class="btn btn-primary" onclick="showAddTaskModal()">+ Nouvelle t√¢che</button>
                                </div>

                                <!-- Filter tabs -->
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; border-bottom: 2px solid var(--border);">
                                    <button class="btn" style="background: none; border: none; padding: 0.75rem 1rem; border-bottom: 3px solid var(--primary); color: var(--primary); font-weight: 600;">Toutes (10)</button>
                                    <button class="btn" style="background: none; border: none; padding: 0.75rem 1rem; border-bottom: 3px solid transparent; color: var(--text-gray);">En cours (8)</button>
                                    <button class="btn" style="background: none; border: none; padding: 0.75rem 1rem; border-bottom: 3px solid transparent; color: var(--text-gray);">Compl√©t√©es (24)</button>
                                    <button class="btn" style="background: none; border: none; padding: 0.75rem 1rem; border-bottom: 3px solid transparent; color: var(--danger);">En retard (2)</button>
                                </div>

                                <div id="taskList" style="max-height: 600px; overflow-y: auto;">
                                    <!-- Tasks will be listed here - showing sample format -->
                                    <div style="padding: 1rem; border: 1px solid var(--border); border-left: 4px solid var(--danger); border-radius: 8px; margin-bottom: 1rem; cursor: pointer;" onclick="showTaskDetails(1)">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div style="display: flex; align-items: start; gap: 1rem; flex: 1;">
                                                <input type="checkbox" style="margin-top: 0.25rem;">
                                                <div style="flex: 1;">
                                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">D√©claration TVA T4 2024</div>
                                                    <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.5rem;">
                                                        Pr√©parer et soumettre la d√©claration de TVA pour le dernier trimestre 2024
                                                    </div>
                                                    <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--text-gray);">
                                                        <span>üìÖ 21 Jan 2025</span>
                                                        <span>üë§ Marie Martin</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="badge badge-danger">Urgent</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Upcoming Deadlines -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üéØ Prochaines √©ch√©ances</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #fee2e2; border-radius: 8px; border-left: 3px solid var(--danger);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">21</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">JAN</div>
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">TVA T4 2024</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">D√©claration trimestrielle</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Task Statistics -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üìä Statistiques</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Taux de compl√©tion</div>
                                        <div style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;">75%</div>
                                        <div style="width: 100%; height: 8px; background: white; border-radius: 4px; overflow: hidden;">
                                            <div style="width: 75%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other views will be added here -->
                <!-- Tr√©sorerie View -->
                <div id="viewTresorerie" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">Solde actuel</div>
                            <div class="stat-value">‚Ç¨ 48,250</div>
                            <div class="stat-change positive">+12% ce mois</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Entr√©es (30j)</div>
                            <div class="stat-value" style="color: var(--success);">‚Ç¨ 35,600</div>
                            <div class="stat-change">18 transactions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Sorties (30j)</div>
                            <div class="stat-value" style="color: var(--danger);">‚Ç¨ 28,400</div>
                            <div class="stat-change">24 transactions</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Full Cashflow Chart -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">√âvolution de la tr√©sorerie</div>
                                    <div style="display: flex; gap: 1rem;">
                                        <select id="cashflowPeriod" onchange="updateCashflowChart()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                            <option value="7">7 jours</option>
                                            <option value="30" selected>30 jours</option>
                                            <option value="90">90 jours</option>
                                            <option value="365">1 an</option>
                                        </select>
                                        <button class="btn btn-outline" style="padding: 0.5rem 1rem;" onclick="refreshCashflow()">üîÑ Actualiser</button>
                                    </div>
                                </div>
                                <div class="chart-container" style="height: 400px;">
                                    <canvas id="cashflowFullChart"></canvas>
                                </div>
                            </div>

                            <!-- All Transactions -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Toutes les transactions</div>
                                    <div style="display: flex; gap: 1rem;">
                                        <select id="filterCategory" onchange="filterTransactions()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                            <option value="all">Toutes cat√©gories</option>
                                            <option value="vente">Ventes</option>
                                            <option value="achat">Achats</option>
                                            <option value="charge">Charges</option>
                                            <option value="salaire">Salaires</option>
                                            <option value="taxe">Taxes</option>
                                        </select>
                                        <input type="text" id="searchTransaction" placeholder="Rechercher..." style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); min-width: 200px;">
                                    </div>
                                </div>
                                <div style="max-height: 500px; overflow-y: auto;">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Description</th>
                                                <th>Cat√©gorie</th>
                                                <th>Montant</th>
                                                <th>Solde</th>
                                            </tr>
                                        </thead>
                                        <tbody id="allTransactionsBody">
                                            <tr>
                                                <td>20 D√©c 2024</td>
                                                <td>Virement client ABC - Facture F-2024-001</td>
                                                <td><span class="badge">Vente</span></td>
                                                <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 2,500.00</td>
                                                <td>‚Ç¨ 48,250.00</td>
                                            </tr>
                                            <tr>
                                                <td>19 D√©c 2024</td>
                                                <td>Loyer bureau - D√©cembre</td>
                                                <td><span class="badge">Charge</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 1,200.00</td>
                                                <td>‚Ç¨ 45,750.00</td>
                                            </tr>
                                            <tr>
                                                <td>18 D√©c 2024</td>
                                                <td>Facture fournisseur XYZ - Mat√©riel</td>
                                                <td><span class="badge">Achat</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 850.00</td>
                                                <td>‚Ç¨ 46,950.00</td>
                                            </tr>
                                            <tr>
                                                <td>17 D√©c 2024</td>
                                                <td>Virement client DEF - Facture F-2024-002</td>
                                                <td><span class="badge">Vente</span></td>
                                                <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 3,200.00</td>
                                                <td>‚Ç¨ 47,800.00</td>
                                            </tr>
                                            <tr>
                                                <td>15 D√©c 2024</td>
                                                <td>Salaires - √âquipe</td>
                                                <td><span class="badge">Salaire</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 8,500.00</td>
                                                <td>‚Ç¨ 44,600.00</td>
                                            </tr>
                                            <tr>
                                                <td>14 D√©c 2024</td>
                                                <td>TVA T3 - Paiement</td>
                                                <td><span class="badge">Taxe</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 4,200.00</td>
                                                <td>‚Ç¨ 53,100.00</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Forecast -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Pr√©visions 30 jours</div>
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="forecastChart"></canvas>
                                </div>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="color: var(--text-gray);">Solde estim√© (30j)</span>
                                        <span style="font-weight: 600;">‚Ç¨ 52,100</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--text-gray);">Variation</span>
                                        <span style="font-weight: 600; color: var(--success);">+‚Ç¨ 3,850 (+8%)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Categories Breakdown -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©partition par cat√©gorie</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Ventes</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--success);">‚Ç¨ 15,800</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 55%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Salaires</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 8,500</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 30%; height: 100%; background: var(--danger);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Achats</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 4,200</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 15%; height: 100%; background: var(--warning);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Charges</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 3,100</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 11%; height: 100%; background: var(--primary);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Taxes</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 4,200</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 15%; height: 100%; background: #8b5cf6;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Export -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Export des donn√©es</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <button class="btn btn-outline" onclick="exportCSV()">üìä Export CSV</button>
                                    <button class="btn btn-outline" onclick="exportPDF()">üìÑ Export PDF</button>
                                    <button class="btn btn-outline" onclick="exportExcel()">üìó Export Excel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Factures View -->
                <div id="viewFactures" class="view hidden">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Gestion des factures</div>
                            <button class="btn btn-primary" onclick="showCreateInvoiceModal()">+ Nouvelle facture</button>
                        </div>
                        
                        <!-- Filters -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <select id="filterStatus" onchange="filterInvoices()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                <option value="all">Tous les statuts</option>
                                <option value="draft">Brouillon</option>
                                <option value="sent">Envoy√©e</option>
                                <option value="paid">Pay√©e</option>
                                <option value="overdue">En retard</option>
                            </select>
                            <input type="text" id="searchInvoice" placeholder="Rechercher..." style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); flex: 1; min-width: 200px;">
                        </div>

                        <!-- Invoices Table -->
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>N¬∞ Facture</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>√âch√©ance</th>
                                    <th>Montant HT</th>
                                    <th>Montant TTC</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoicesTableBody">
                                <tr>
                                    <td><strong>F-2024-001</strong></td>
                                    <td>Client ABC</td>
                                    <td>15 D√©c 2024</td>
                                    <td>15 Jan 2025</td>
                                    <td>‚Ç¨ 2,000.00</td>
                                    <td>‚Ç¨ 2,400.00</td>
                                    <td><span class="badge badge-success">Pay√©e</span></td>
                                    <td>
                                        <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewInvoice(1)">Voir</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>F-2024-002</strong></td>
                                    <td>Client XYZ</td>
                                    <td>18 D√©c 2024</td>
                                    <td>18 Jan 2025</td>
                                    <td>‚Ç¨ 1,500.00</td>
                                    <td>‚Ç¨ 1,800.00</td>
                                    <td><span class="badge badge-warning">Envoy√©e</span></td>
                                    <td>
                                        <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewInvoice(2)">Voir</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>F-2024-003</strong></td>
                                    <td>Entreprise DEF</td>
                                    <td>10 D√©c 2024</td>
                                    <td>10 Jan 2025</td>
                                    <td>‚Ç¨ 850.00</td>
                                    <td>‚Ç¨ 1,020.00</td>
                                    <td><span class="badge badge-danger">En retard</span></td>
                                    <td>
                                        <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewInvoice(3)">Voir</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Invoice Statistics -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                        <div class="card">
                            <div class="stat-label">Total factur√©</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 25,380</div>
                        </div>
                        <div class="card">
                            <div class="stat-label">En attente</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--warning);">‚Ç¨ 12,500</div>
                        </div>
                        <div class="card">
                            <div class="stat-label">Pay√©es</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--success);">‚Ç¨ 10,200</div>
                        </div>
                        <div class="card">
                            <div class="stat-label">En retard</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--danger);">‚Ç¨ 2,680</div>
                        </div>
                    </div>
                </div>

                <!-- Import View -->
                <div id="viewImport" class="view hidden">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-title" style="margin-bottom: 0.5rem;">Import de donn√©es</div>
                        <p style="color: var(--text-gray); margin-bottom: 2rem;">Importez vos donn√©es bancaires, factures et documents comptables. Formats accept√©s: CSV, PDF, XLSX</p>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                            <!-- Bank Transactions -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìä Transactions bancaires</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('bankFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="bankFile" accept=".csv,.pdf" style="display: none;" onchange="handleBankUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV ou PDF accept√©s</div>
                                </div>
                                <div id="bankUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">18 D√©c 2024 - 30 transactions</div>
                                </div>
                            </div>

                            <!-- Sales Invoices -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìÑ Factures de vente</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('salesFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="salesFile" accept=".csv,.xlsx,.pdf" style="display: none;" onchange="handleSalesUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV, XLSX ou PDF accept√©s</div>
                                </div>
                                <div id="salesUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">15 D√©c 2024 - 25 factures</div>
                                </div>
                            </div>

                            <!-- Purchase Invoices -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìã Factures fournisseurs</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('purchaseFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="purchaseFile" accept=".csv,.xlsx,.pdf" style="display: none;" onchange="handlePurchaseUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV, XLSX ou PDF accept√©s</div>
                                </div>
                                <div id="purchaseUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">16 D√©c 2024 - 18 factures</div>
                                </div>
                            </div>

                            <!-- Trial Balance -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìà Balance comptable</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('trialBalanceFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="trialBalanceFile" accept=".csv,.pdf" style="display: none;" onchange="handleTrialBalanceUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV ou PDF accept√©s</div>
                                </div>
                                <div id="trialBalanceUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem;">
                                    <a href="#" onclick="downloadSampleBalance(); return false;" style="color: var(--primary); text-decoration: underline; font-size: 0.875rem;">
                                        üì• T√©l√©charger un exemple de fichier
                                    </a>
                                </div>
                            </div>

                            <!-- General Documents -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìé Documents divers</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('generalDocsFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="generalDocsFile" accept=".pdf,.csv,.xlsx,.doc,.docx" multiple style="display: none;" onchange="handleGeneralDocsUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez des fichiers</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">Tous formats accept√©s (PDF, CSV, XLSX, DOC)</div>
                                    <div style="font-size: 0.75rem; color: var(--text-gray); margin-top: 0.5rem;">S√©lection multiple possible</div>
                                </div>
                                <div id="generalDocsUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Documents stock√©s:</div>
                                    <div style="color: var(--text-gray);">12 fichiers</div>
                                </div>
                            </div>

                            <!-- Tax Documents -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üèõÔ∏è Documents fiscaux</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('taxDocsFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="taxDocsFile" accept=".pdf,.csv" multiple style="display: none;" onchange="handleTaxDocsUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez des fichiers</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">D√©clarations TVA, liasses fiscales, etc.</div>
                                </div>
                                <div id="taxDocsUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">01 D√©c 2024 - D√©claration TVA T3</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Import History -->
                    <div class="card">
                        <div class="card-title" style="margin-bottom: 1.5rem;">Historique des imports</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Fichier</th>
                                    <th>Format</th>
                                    <th>Enregistrements</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="importHistoryTable">
                                <tr>
                                    <td>18 D√©c 2024 14:30</td>
                                    <td>Transactions bancaires</td>
                                    <td>relev√©_decembre.csv</td>
                                    <td><span class="badge">CSV</span></td>
                                    <td>30</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(1)">Voir</button></td>
                                </tr>
                                <tr>
                                    <td>16 D√©c 2024 09:15</td>
                                    <td>Factures fournisseurs</td>
                                    <td>factures_t4.pdf</td>
                                    <td><span class="badge" style="background: #fee2e2; color: #991b1b;">PDF</span></td>
                                    <td>18</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(2)">Voir</button></td>
                                </tr>
                                <tr>
                                    <td>15 D√©c 2024 16:45</td>
                                    <td>Factures de vente</td>
                                    <td>ventes_decembre.xlsx</td>
                                    <td><span class="badge" style="background: #d1fae5; color: #065f46;">XLSX</span></td>
                                    <td>25</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(3)">Voir</button></td>
                                </tr>
                                <tr>
                                    <td>01 D√©c 2024 10:20</td>
                                    <td>Documents fiscaux</td>
                                    <td>declaration_tva_t3.pdf</td>
                                    <td><span class="badge" style="background: #fee2e2; color: #991b1b;">PDF</span></td>
                                    <td>1</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(4)">Voir</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Help Section -->
                    <div class="card" style="background: #eff6ff; border: 1px solid var(--primary);">
                        <div style="display: flex; gap: 1rem;">
                            <div style="font-size: 2rem;">üí°</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--primary);">Besoin d'aide pour l'import ?</div>
                                <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 1rem;">
                                    <strong>Formats support√©s:</strong>
                                    <ul style="margin: 0.5rem 0 0 1.5rem; line-height: 1.8;">
                                        <li><strong>CSV</strong> - Donn√©es structur√©es (transactions, factures)</li>
                                        <li><strong>PDF</strong> - Documents scann√©s (relev√©s bancaires, factures, d√©clarations)</li>
                                        <li><strong>XLSX</strong> - Tableaux Excel (exports comptables)</li>
                                    </ul>
                                    Notre syst√®me extrait automatiquement les donn√©es des PDF gr√¢ce √† l'OCR.
                                </div>
                                <button class="btn btn-primary" style="padding: 0.5rem 1rem;">üìñ Voir le guide complet</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alertes View -->
                <div id="viewAlertes" class="view hidden">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Alertes et notifications</div>
                            <button class="btn btn-outline" onclick="markAllAlertsRead()">‚úì Tout marquer comme lu</button>
                        </div>

                        <!-- Filter -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <select id="filterAlertType" onchange="filterAlerts()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                <option value="all">Tous les types</option>
                                <option value="fiscal">Fiscal</option>
                                <option value="invoice">Factures</option>
                                <option value="cash">Tr√©sorerie</option>
                                <option value="advice">Conseils</option>
                            </select>
                            <select id="filterAlertPriority" onchange="filterAlerts()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                <option value="all">Toutes priorit√©s</option>
                                <option value="high">Urgente</option>
                                <option value="medium">Moyenne</option>
                                <option value="low">Faible</option>
                            </select>
                        </div>
                    </div>

                    <!-- Urgent Alerts -->
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-title" style="margin-bottom: 1rem; color: var(--danger);">‚ö†Ô∏è Alertes urgentes</div>
                        <div id="urgentAlerts">
                            <div class="notification-item danger" style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: between; align-items: start; gap: 1rem;">
                                    <div style="flex: 1;">
                                        <div class="notification-title">TVA trimestrielle √† d√©clarer</div>
                                        <div class="notification-text">La d√©claration de TVA du T4 2024 doit √™tre soumise avant le 24 janvier 2025. Montant estim√©: ‚Ç¨ 4,200</div>
                                        <div class="notification-date">√âch√©ance dans 4 jours</div>
                                    </div>
                                    <button class="btn btn-primary" style="padding: 0.5rem 1rem; white-space: nowrap;">Traiter</button>
                                </div>
                            </div>

                            <div class="notification-item danger" style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                                    <div style="flex: 1;">
                                        <div class="notification-title">Factures en retard de paiement</div>
                                        <div class="notification-text">3 factures sont en retard de paiement pour un montant total de ‚Ç¨ 2,680. Relance recommand√©e.</div>
                                        <div class="notification-date">Retard moyen: 8 jours</div>
                                    </div>
                                    <button class="btn btn-outline" style="padding: 0.5rem 1rem; white-space: nowrap;" onclick="switchView('factures')">Voir</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Recent Alerts -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Toutes les alertes</div>
                                <div id="allAlerts">
                                    <div class="notification-item warning">
                                        <div class="notification-title">üí° Optimisation fiscale sugg√©r√©e</div>
                                        <div class="notification-text">Vous pouvez d√©duire jusqu'√† ‚Ç¨ 1,500 de charges suppl√©mentaires avant la fin de l'exercice. Consultez l'analyse fiscale pour plus de d√©tails.</div>
                                        <div class="notification-date">Aujourd'hui √† 10:30</div>
                                    </div>

                                    <div class="notification-item info">
                                        <div class="notification-title">üìä Rapport mensuel disponible</div>
                                        <div class="notification-text">Votre rapport de tr√©sorerie pour d√©cembre 2024 est maintenant disponible. Revenus: +8% vs novembre.</div>
                                        <div class="notification-date">Aujourd'hui √† 09:00</div>
                                    </div>

                                    <div class="notification-item warning">
                                        <div class="notification-title">üí∞ Tr√©sorerie pr√©visionnelle</div>
                                        <div class="notification-text">Votre solde de tr√©sorerie pourrait descendre sous ‚Ç¨ 30,000 fin janvier en raison des paiements TVA et salaires.</div>
                                        <div class="notification-date">Hier √† 16:45</div>
                                    </div>

                                    <div class="notification-item info">
                                        <div class="notification-title">‚úÖ Import r√©ussi</div>
                                        <div class="notification-text">30 transactions bancaires ont √©t√© import√©es avec succ√®s depuis votre fichier relev√©_decembre.csv</div>
                                        <div class="notification-date">18 D√©c √† 14:30</div>
                                    </div>

                                    <div class="notification-item warning">
                                        <div class="notification-title">üìÑ Facture bient√¥t √©chue</div>
                                        <div class="notification-text">La facture F-2024-002 (Client XYZ - ‚Ç¨ 1,800) arrive √† √©ch√©ance dans 7 jours.</div>
                                        <div class="notification-date">18 D√©c √† 09:00</div>
                                    </div>

                                    <div class="notification-item info">
                                        <div class="notification-title">üéØ Objectif mensuel atteint</div>
                                        <div class="notification-text">F√©licitations ! Vous avez atteint votre objectif de chiffre d'affaires pour d√©cembre (‚Ç¨ 25,000)</div>
                                        <div class="notification-date">17 D√©c √† 18:20</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Alert Statistics -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Statistiques</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Alertes non lues</div>
                                        <div style="font-size: 1.75rem; font-weight: 700; color: var(--danger);">5</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Urgentes</div>
                                        <div style="font-size: 1.75rem; font-weight: 700; color: var(--warning);">2</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Cette semaine</div>
                                        <div style="font-size: 1.75rem; font-weight: 700;">12</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Alert Types -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Par type</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üìä</span>
                                            <span>Fiscal</span>
                                        </div>
                                        <span style="font-weight: 600;">3</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üìÑ</span>
                                            <span>Factures</span>
                                        </div>
                                        <span style="font-weight: 600;">4</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üí∞</span>
                                            <span>Tr√©sorerie</span>
                                        </div>
                                        <span style="font-weight: 600;">2</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üí°</span>
                                            <span>Conseils</span>
                                        </div>
                                        <span style="font-weight: 600;">3</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Calendar -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Prochaines √©ch√©ances</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="display: flex; gap: 1rem; padding: 0.75rem; background: #fef2f2; border-radius: 8px; border-left: 3px solid var(--danger);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">24</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">JAN</div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">TVA T4</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">‚Ç¨ 4,200</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 1rem; padding: 0.75rem; background: #fffbeb; border-radius: 8px; border-left: 3px solid var(--warning);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">31</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">JAN</div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Cl√¥ture exercice</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">Fiscal 2024</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 1rem; padding: 0.75rem; background: var(--bg-light); border-radius: 8px; border-left: 3px solid var(--primary);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">15</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">F√âV</div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Paiement salaires</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">‚Ç¨ 8,500</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analyse Fiscale View -->
                <div id="viewAnalyse" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">Imp√¥t estim√© 2024</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 18,500</div>
                            <div class="stat-change">IS √† 25%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">√âconomies possibles</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--success);">‚Ç¨ 3,200</div>
                            <div class="stat-change positive">-17%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Charges d√©ductibles</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 45,600</div>
                            <div class="stat-change">62% du CA</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Score fiscal</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--warning);">72/100</div>
                            <div class="stat-change">Optimisable</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Recommendations -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1.5rem;">üéØ Recommandations d'optimisation</div>
                                
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1.5rem; background: #d1fae5; border-radius: 12px; border-left: 4px solid var(--success);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div style="font-weight: 600; font-size: 1.125rem;">Augmentez vos charges d√©ductibles</div>
                                            <span class="badge badge-success">√âconomie: ‚Ç¨ 1,200</span>
                                        </div>
                                        <div style="color: var(--text-gray); margin-bottom: 1rem; line-height: 1.6;">
                                            Vous pouvez d√©duire jusqu'√† ‚Ç¨ 4,000 de charges suppl√©mentaires avant la cl√¥ture. Investissez dans du mat√©riel professionnel, formation, ou logiciels pour optimiser votre fiscalit√©.
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.5rem;"><strong>Actions sugg√©r√©es:</strong></div>
                                        <ul style="margin-left: 1.5rem; color: var(--text-gray); font-size: 0.875rem; line-height: 1.8;">
                                            <li>Achat de mat√©riel informatique avant le 31/12</li>
                                            <li>Investissement dans des formations professionnelles</li>
                                            <li>Abonnements logiciels annuels</li>
                                        </ul>
                                        <button class="btn btn-primary" style="margin-top: 1rem;">En savoir plus</button>
                                    </div>

                                    <div style="padding: 1.5rem; background: #fef3c7; border-radius: 12px; border-left: 4px solid var(--warning);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div style="font-weight: 600; font-size: 1.125rem;">Optimisez vos amortissements</div>
                                            <span class="badge badge-warning">√âconomie: ‚Ç¨ 1,400</span>
                                        </div>
                                        <div style="color: var(--text-gray); margin-bottom: 1rem; line-height: 1.6;">
                                            Certains de vos actifs peuvent b√©n√©ficier d'amortissements acc√©l√©r√©s ou d√©gressifs. Une r√©vision de votre plan d'amortissement pourrait r√©duire votre base imposable.
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.5rem;"><strong>Actifs concern√©s:</strong></div>
                                        <ul style="margin-left: 1.5rem; color: var(--text-gray); font-size: 0.875rem; line-height: 1.8;">
                                            <li>V√©hicules professionnels (amortissement d√©gressif)</li>
                                            <li>Mat√©riel informatique (dur√©e 3 ans)</li>
                                            <li>Am√©nagements bureau (sur 10 ans)</li>
                                        </ul>
                                        <button class="btn btn-outline" style="margin-top: 1rem;">Consulter un expert</button>
                                    </div>

                                    <div style="padding: 1.5rem; background: #eff6ff; border-radius: 12px; border-left: 4px solid var(--primary);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div style="font-weight: 600; font-size: 1.125rem;">Cr√©dit d'imp√¥t recherche (CIR)</div>
                                            <span class="badge" style="background: #dbeafe; color: var(--primary);">√âconomie: ‚Ç¨ 600</span>
                                        </div>
                                        <div style="color: var(--text-gray); margin-bottom: 1rem; line-height: 1.6;">
                                            Votre activit√© pourrait √™tre √©ligible au cr√©dit d'imp√¥t recherche. Si vous d√©veloppez des produits innovants ou menez des activit√©s de R&D, vous pourriez r√©cup√©rer 30% des d√©penses √©ligibles.
                                        </div>
                                        <button class="btn btn-outline" style="margin-top: 1rem;">V√©rifier l'√©ligibilit√©</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Tax Breakdown -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©partition fiscale 2024</div>
                                <div style="height: 300px;">
                                    <canvas id="taxBreakdownChart"></canvas>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">TVA</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 16,800</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">IS</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 18,500</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Charges sociales</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 28,200</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Autres taxes</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 2,400</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Fiscal Score -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Score d'optimisation fiscale</div>
                                <div style="text-align: center; padding: 2rem 0;">
                                    <div style="font-size: 4rem; font-weight: 700; color: var(--warning);">72</div>
                                    <div style="font-size: 1.125rem; color: var(--text-gray); margin-bottom: 1rem;">sur 100</div>
                                    <div style="width: 100%; height: 12px; background: var(--bg-light); border-radius: 6px; overflow: hidden;">
                                        <div style="width: 72%; height: 100%; background: linear-gradient(90deg, var(--warning), var(--success));"></div>
                                    </div>
                                </div>
                                <div style="font-size: 0.875rem; color: var(--text-gray); line-height: 1.6; margin-top: 1rem;">
                                    Votre strat√©gie fiscale est bonne mais optimisable. Suivez nos recommandations pour √©conomiser jusqu'√† ‚Ç¨ 3,200.
                                </div>
                            </div>

                            <!-- Deductibility Analysis -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Analyse de d√©ductibilit√©</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.875rem;">Charges optimales</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--success);">92%</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 92%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.875rem;">Amortissements</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--warning);">65%</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 65%; height: 100%; background: var(--warning);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.875rem;">Cr√©dits d'imp√¥t</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">30%</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 30%; height: 100%; background: var(--danger);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Comparison -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Comparaison sectorielle</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Taux d'imposition effectif</div>
                                        <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                            <span style="font-size: 1.5rem; font-weight: 700;">18.2%</span>
                                            <span style="font-size: 0.875rem; color: var(--text-gray);">Moyenne: 21.5%</span>
                                        </div>
                                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--success); font-weight: 600;">-3.3% vs secteur ‚úì</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Charges / CA</div>
                                        <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                            <span style="font-size: 1.5rem; font-weight: 700;">62%</span>
                                            <span style="font-size: 0.875rem; color: var(--text-gray);">Moyenne: 58%</span>
                                        </div>
                                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--warning); font-weight: 600;">+4% vs secteur</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Actions rapides</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <button class="btn btn-primary" style="justify-content: center;">üìä G√©n√©rer rapport complet</button>
                                    <button class="btn btn-outline" style="justify-content: center;">üë®‚Äçüíº Contacter un expert</button>
                                    <button class="btn btn-outline" style="justify-content: center;">üìÖ Planifier optimisation</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Invoice Modal -->
    <div id="createInvoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Cr√©er une facture</div>
                <button class="modal-close" onclick="hideCreateInvoiceModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="createInvoiceForm">
                    <div class="form-group">
                        <label class="form-label">Client</label>
                        <select class="form-select" id="invoiceClient" required>
                            <option value="">S√©lectionner un client...</option>
                            <option value="client1">Client ABC</option>
                            <option value="client2">Client XYZ</option>
                            <option value="client3">Entreprise DEF</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Date de facture</label>
                            <input type="date" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date d'√©ch√©ance</label>
                            <input type="date" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-input" placeholder="Prestation de services..." required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Montant HT</label>
                            <input type="number" class="form-input" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">TVA (%)</label>
                            <select class="form-select" required>
                                <option value="20">20%</option>
                                <option value="10">10%</option>
                                <option value="5.5">5.5%</option>
                                <option value="0">0%</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes (optionnel)</label>
                        <textarea class="form-textarea" placeholder="Conditions de paiement, remarques..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Cr√©er la facture</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ajouter un utilisateur</div>
                <button class="modal-close" onclick="hideAddUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Niveau d'acc√®s</label>
                        <select class="form-select" required>
                            <option value="">S√©lectionner...</option>
                            <option value="admin">Admin - Acc√®s complet</option>
                            <option value="comptable">Comptable - Factures, tr√©sorerie, fiscalit√©</option>
                            <option value="consultation">Consultation - Lecture seule</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Ajouter</button>
                </form>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Configuration
        const API_BASE = 'https://optimis-fiscale-production.up.railway.app';
        let currentUser = {
            name: 'Jean Dupont',
            company: 'Entreprise ABC',
            accessLevel: 'admin' // admin, comptable, consultation
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            initChart();
            loadNotifications();
            checkAccessLevel();
            
            // Check auth token
            const token = localStorage.getItem('authToken');
            if (!token) {
                // Redirect to login page
                window.location.href = 'login.html';
                return;
            }
            
            // Load user data
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                const user = JSON.parse(userData);
                if (user.company_name) {
                    document.getElementById('userCompany').textContent = user.company_name;
                }
                if (user.contact_name) {
                    document.getElementById('userName').textContent = user.contact_name;
                }
            }
        });

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('fr-FR', options);
        }

        // Switch view
        function switchView(view) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Update page title
            const titles = {
                'dashboard': 'Tableau de bord',
                'tresorerie': 'Tr√©sorerie',
                'factures': 'Factures',
                'planning': 'Planning',
                'import': 'Import',
                'alertes': 'Alertes',
                'analyse': 'Analyse fiscale',
                'espace-client': 'Espace client'
            };
            document.getElementById('pageTitle').textContent = titles[view] || 'Dashboard';

            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));

            // Show selected view
            const viewMap = {
                'dashboard': 'viewDashboard',
                'tresorerie': 'viewTresorerie',
                'factures': 'viewFactures',
                'planning': 'viewPlanning',
                'import': 'viewImport',
                'alertes': 'viewAlertes',
                'analyse': 'viewAnalyse',
                'espace-client': 'viewEspaceClient'
            };

            const viewId = viewMap[view];
            if (viewId) {
                document.getElementById(viewId).classList.remove('hidden');
            }
        }

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('tresorerieChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['14 D√©c', '15 D√©c', '16 D√©c', '17 D√©c', '18 D√©c', '19 D√©c', '20 D√©c'],
                    datasets: [{
                        label: 'Tr√©sorerie',
                        data: [45000, 46200, 45800, 47000, 46500, 47800, 48250],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Load notifications based on company type and date
        function loadNotifications() {
            const now = new Date();
            const day = now.getDate();
            const notificationsList = document.getElementById('notificationsList');
            
            // Get company info
            const tvaRegime = document.getElementById('tvaPeriod')?.value || 'mensuelle';
            
            // Add automatic notifications based on date
            let notifications = [];
            
            // TVA notification (21st or 24th depending on regime)
            if (tvaRegime === 'trimestrielle' && day >= 20 && day <= 24) {
                notifications.push({
                    type: 'danger',
                    title: '‚ö†Ô∏è TVA trimestrielle',
                    text: 'D√©claration TVA √† soumettre avant le 24 de ce mois',
                    date: 'Urgent'
                });
            } else if (tvaRegime === 'mensuelle' && day >= 17 && day <= 21) {
                notifications.push({
                    type: 'danger',
                    title: '‚ö†Ô∏è TVA mensuelle',
                    text: 'D√©claration TVA √† soumettre avant le 21 de ce mois',
                    date: 'Urgent'
                });
            }
            
            // Keep existing notifications
            // (would load from backend in production)
        }

        // Check access level and hide/show sections
        function checkAccessLevel() {
            const accessLevel = currentUser.accessLevel;
            
            // Update badge
            const badge = document.getElementById('userAccessLevel');
            const accessLabels = {
                'admin': 'Admin',
                'comptable': 'Comptable',
                'consultation': 'Consultation'
            };
            badge.textContent = accessLabels[accessLevel];
            
            // Show/hide user management section
            const userMgmt = document.getElementById('userManagementSection');
            if (accessLevel !== 'admin' && userMgmt) {
                userMgmt.style.display = 'none';
            }
            
            // Disable editing for consultation users
            if (accessLevel === 'consultation') {
                document.querySelectorAll('.form-input, .form-select').forEach(input => {
                    input.disabled = true;
                });
                document.querySelectorAll('.btn-primary').forEach(btn => {
                    btn.style.display = 'none';
                });
            }
        }

        // Modal functions
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('active');
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.remove('active');
        }

        function editUser(userId) {
            alert('Edit user ' + userId);
        }

        // Logout
        function handleLogout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                // Redirect to login
                window.location.href = 'login.html';
            }
        }

        // Save client info
        document.getElementById('clientInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Informations enregistr√©es avec succ√®s !');
        });

        // Add user
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Utilisateur ajout√© avec succ√®s !');
            hideAddUserModal();
        });

        // Invoice functions
        function showCreateInvoiceModal() {
            document.getElementById('createInvoiceModal').classList.add('active');
        }

        function hideCreateInvoiceModal() {
            document.getElementById('createInvoiceModal').classList.remove('active');
        }

        function filterInvoices() {
            console.log('Filtering invoices...');
        }

        function viewInvoice(id) {
            alert('Viewing invoice #' + id);
        }

        document.getElementById('createInvoiceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const client = document.getElementById('invoiceClient').value;
            alert('Facture cr√©√©e pour ' + client);
            hideCreateInvoiceModal();
        });

        // Cashflow functions
        function updateCashflowChart() {
            console.log('Updating cashflow chart...');
        }

        function refreshCashflow() {
            alert('Actualisation de la tr√©sorerie...');
        }

        function filterTransactions() {
            console.log('Filtering transactions...');
        }

        function exportCSV() {
            alert('Export CSV en cours...');
        }

        function exportPDF() {
            alert('Export PDF en cours...');
        }

        function exportExcel() {
            alert('Export Excel en cours...');
        }

        // Initialize forecast chart
        function initForecastChart() {
            const ctx = document.getElementById('forecastChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                    datasets: [{
                        label: 'Pr√©vision',
                        data: [48250, 49100, 50800, 52100],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderDash: [5, 5],
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Initialize full cashflow chart
        function initCashflowFullChart() {
            const ctx = document.getElementById('cashflowFullChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1 D√©c', '5 D√©c', '10 D√©c', '15 D√©c', '20 D√©c', '25 D√©c', '30 D√©c'],
                    datasets: [{
                        label: 'Solde',
                        data: [42000, 44500, 43800, 46200, 47500, 46800, 48250],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Import functions
        function handleBankUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('bankUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                const recordCount = fileType === 'PDF' ? 'Extraction en cours...' : '30 transactions';
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${recordCount} import√©es depuis ${file.name} (${fileType})</div></div>`;
                
                // Add to history
                addToImportHistory('Transactions bancaires', file.name, fileType, recordCount);
            }
        }

        function handleSalesUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('salesUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                const recordCount = fileType === 'PDF' ? 'Extraction en cours...' : '25 factures';
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${recordCount} import√©es depuis ${file.name} (${fileType})</div></div>`;
                
                addToImportHistory('Factures de vente', file.name, fileType, recordCount);
            }
        }

        function handlePurchaseUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('purchaseUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                const recordCount = fileType === 'PDF' ? 'Extraction en cours...' : '18 factures';
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${recordCount} import√©es depuis ${file.name} (${fileType})</div></div>`;
                
                addToImportHistory('Factures fournisseurs', file.name, fileType, recordCount);
            }
        }

        function handleTrialBalanceUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('trialBalanceUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Analyse en cours</div><div class="notification-text">Balance comptable import√©e (${fileType}). Analyse fiscale disponible.</div></div>`;
                
                addToImportHistory('Balance comptable', file.name, fileType, '1 fichier');
                
                setTimeout(() => {
                    switchView('analyse');
                }, 2000);
            }
        }

        function handleGeneralDocsUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                const status = document.getElementById('generalDocsUploadStatus');
                status.classList.remove('hidden');
                const fileList = Array.from(files).map(f => f.name).join(', ');
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${files.length} fichier(s) import√©(s): ${fileList}</div></div>`;
                
                for (let file of files) {
                    const fileType = file.name.split('.').pop().toUpperCase();
                    addToImportHistory('Documents divers', file.name, fileType, '1 fichier');
                }
            }
        }

        function handleTaxDocsUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                const status = document.getElementById('taxDocsUploadStatus');
                status.classList.remove('hidden');
                const fileList = Array.from(files).map(f => f.name).join(', ');
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${files.length} document(s) fiscal(ux) import√©(s)</div></div>`;
                
                for (let file of files) {
                    const fileType = file.name.split('.').pop().toUpperCase();
                    addToImportHistory('Documents fiscaux', file.name, fileType, '1 document');
                }
            }
        }

        function addToImportHistory(type, filename, format, records) {
            const table = document.getElementById('importHistoryTable');
            if (!table) return;
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            
            const badgeColors = {
                'CSV': 'background: #dbeafe; color: #1e40af;',
                'PDF': 'background: #fee2e2; color: #991b1b;',
                'XLSX': 'background: #d1fae5; color: #065f46;',
                'DOC': 'background: #fef3c7; color: #92400e;',
                'DOCX': 'background: #fef3c7; color: #92400e;'
            };
            
            const row = `
                <tr>
                    <td>${dateStr}</td>
                    <td>${type}</td>
                    <td>${filename}</td>
                    <td><span class="badge" style="${badgeColors[format] || ''}">${format}</span></td>
                    <td>${records}</td>
                    <td><span class="badge badge-success">R√©ussi</span></td>
                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails()">Voir</button></td>
                </tr>
            `;
            
            table.insertAdjacentHTML('afterbegin', row);
        }

        function viewImportDetails(id) {
            alert('D√©tails de l\'import #' + (id || 'nouveau'));
        }

        function downloadSampleBalance() {
            const csvContent = `account,label,debit,credit
701,VENTES DE PRODUITS FINIS,0,100000
6061,ACHATS MATIERES,40000,0
611,SOUS-TRAITANCE GENERALE,10000,0
623,PUBLICITE,5000,0
635,IMPOTS ET TAXES,3000,0
641,REMUNERATIONS DU PERSONNEL,25000,0
645,CHARGES SOCIALES,12000,0
681,DOTATIONS AUX AMORTISSEMENTS,5000,0
44571,TVA COLLECTEE,0,20000
44566,TVA DEDUCTIBLE,15000,0
512,BANQUES,50000,0
411,CLIENTS,30000,0
401,FOURNISSEURS,0,20000`;
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'exemple_balance_comptable.csv';
            link.click();
        }

        // Alert functions
        function filterAlerts() {
            console.log('Filtering alerts...');
        }

        function markAllAlertsRead() {
            if (confirm('Marquer toutes les alertes comme lues ?')) {
                alert('Toutes les alertes ont √©t√© marqu√©es comme lues');
            }
        }

        // Tax analysis chart
        function initTaxBreakdownChart() {
            const ctx = document.getElementById('taxBreakdownChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['TVA', 'IS', 'Charges sociales', 'Autres'],
                    datasets: [{
                        data: [16800, 18500, 28200, 2400],
                        backgroundColor: ['#2563eb', '#8b5cf6', '#f59e0b', '#64748b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                                               legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Initialize all charts when views are loaded
        function initAllCharts() {
            setTimeout(() => {
                initForecastChart();
                initCashflowFullChart();
                initTaxBreakdownChart();
            }, 100);
        }

        // Call on page load
        initAllCharts();

        // Planning functions
        function showAddTaskModal() {
            alert('Modal "Nouvelle t√¢che" √† impl√©menter\n\nChamps:\n- Titre\n- Description\n- Date √©ch√©ance\n- Priorit√©\n- Assign√© √†\n- Pi√®ces jointes');
        }

        function showTaskDetails(taskId) {
            alert('D√©tails de la t√¢che #' + taskId + '\n\nAffichera:\n- Informations compl√®tes\n- Commentaires\n- Historique\n- Documents joints');
        }

        function exportPlanning() {
            alert('Export du planning en cours...\n\nFormats disponibles:\n- PDF\n- iCal\n- Excel');
        }

        function syncCalendar() {
            alert('Synchronisation avec calendrier externe\n\nOptions:\n- Google Calendar\n- Outlook\n- Apple Calendar');
        }
    </script>
</body>
</html>
