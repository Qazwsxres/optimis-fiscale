<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUMMA - Dashboard</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-info {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-role {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .user-role-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--bg-light);
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .nav-menu {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            color: var(--text-gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
            font-size: 0.9375rem;
        }

        .nav-item:hover {
            background: var(--bg-light);
            color: var(--primary);
        }

        .nav-item.active {
            background: #eff6ff;
            color: var(--primary);
            font-weight: 600;
            border-left: 3px solid var(--primary);
        }

        .nav-icon {
            font-size: 1.25rem;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .btn-logout {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-dark);
        }

        .btn-logout:hover {
            background: var(--border);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
        }

        .top-bar {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .content-area {
            padding: 2rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .dashboard-left {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .dashboard-right {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-gray);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .stat-change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Notifications */
        .notification-item {
            padding: 1rem;
            border-left: 3px solid var(--border);
            margin-bottom: 0.75rem;
            background: var(--bg-light);
            border-radius: 4px;
        }

        .notification-item.warning {
            border-left-color: var(--warning);
            background: #fffbeb;
        }

        .notification-item.danger {
            border-left-color: var(--danger);
            background: #fef2f2;
        }

        .notification-item.info {
            border-left-color: var(--primary);
            background: #eff6ff;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
        }

        .notification-text {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .notification-date {
            font-size: 0.75rem;
            color: var(--text-gray);
            margin-top: 0.5rem;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.9375rem;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            background: var(--bg-light);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-gray);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Form */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9375rem;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 100;
                transition: left 0.3s;
            }

            .sidebar.open {
                left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">S</div>
                    <span>SUMMA</span>
                </div>
            </div>

            <div class="user-info">
                <div class="user-name" id="userName">Jean Dupont</div>
                <div class="user-role" id="userCompany">Entreprise ABC</div>
                <div class="user-role-badge" id="userAccessLevel">Admin</div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" onclick="switchView('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Tableau de bord</span>
                </div>
                <div class="nav-item" onclick="switchView('tresorerie')">
                    <span class="nav-icon">üí∞</span>
                    <span>Tr√©sorerie</span>
                </div>
                <div class="nav-item" onclick="switchView('factures')">
                    <span class="nav-icon">üìÑ</span>
                    <span>Factures</span>
                </div>
                <div class="nav-item" onclick="switchView('import')">
                    <span class="nav-icon">üìÅ</span>
                    <span>Import</span>
                </div>
                <div class="nav-item" onclick="switchView('alertes')">
                    <span class="nav-icon">üîî</span>
                    <span>Alertes</span>
                </div>
                <div class="nav-item" onclick="switchView('analyse')">
                    <span class="nav-icon">üìà</span>
                    <span>Analyse fiscale</span>
                </div>
                <div class="nav-item" onclick="switchView('espace-client')">
                    <span class="nav-icon">üë§</span>
                    <span>Espace client</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" onclick="handleLogout()">üö™ D√©connexion</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div class="page-title" id="pageTitle">Tableau de bord</div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span id="currentDate"></span>
                </div>
            </div>

            <div class="content-area">
                <!-- Dashboard View -->
                <div id="viewDashboard" class="view">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Tr√©sorerie</div>
                            <div class="stat-value" id="statTresorerie">‚Ç¨ 48,250</div>
                            <div class="stat-change positive">+12%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">√Ä recevoir</div>
                            <div class="stat-value" id="statRecevoir">‚Ç¨ 12,500</div>
                            <div class="stat-change">3 factures</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Revenus (mois)</div>
                            <div class="stat-value" id="statRevenus">‚Ç¨ 25,380</div>
                            <div class="stat-change positive">+8%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prochaine √©ch√©ance</div>
                            <div class="stat-value" style="font-size: 1.25rem;">21 Jan</div>
                            <div class="stat-change">TVA trimestrielle</div>
                        </div>
                    </div>

                    <!-- Main Dashboard Grid -->
                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Tr√©sorerie Chart -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">√âvolution de la tr√©sorerie</div>
                                    <select id="periodSelect" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                        <option value="7">7 jours</option>
                                        <option value="30">30 jours</option>
                                        <option value="90">90 jours</option>
                                    </select>
                                </div>
                                <div class="chart-container">
                                    <canvas id="tresorerieChart"></canvas>
                                </div>
                            </div>

                            <!-- Recent Transactions -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Derni√®res transactions</div>
                                    <button class="btn btn-outline" style="padding: 0.5rem 1rem;" onclick="switchView('tresorerie')">Voir tout</button>
                                </div>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Cat√©gorie</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentTransactions">
                                        <tr>
                                            <td>20 D√©c</td>
                                            <td>Virement client ABC</td>
                                            <td>Vente</td>
                                            <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 2,500</td>
                                        </tr>
                                        <tr>
                                            <td>19 D√©c</td>
                                            <td>Loyer bureau</td>
                                            <td>Charges</td>
                                            <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 1,200</td>
                                        </tr>
                                        <tr>
                                            <td>18 D√©c</td>
                                            <td>Facture fournisseur XYZ</td>
                                            <td>Achat</td>
                                            <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 850</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Notifications / Alertes -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Notifications</div>
                                </div>
                                <div id="notificationsList">
                                    <div class="notification-item danger">
                                        <div class="notification-title">‚ö†Ô∏è TVA √† payer</div>
                                        <div class="notification-text">D√©claration TVA T4 √† soumettre avant le 21 janvier</div>
                                        <div class="notification-date">Dans 2 jours</div>
                                    </div>
                                    <div class="notification-item warning">
                                        <div class="notification-title">üìÑ Facture en retard</div>
                                        <div class="notification-text">Client XYZ - Facture #1234 √©chue depuis 5 jours</div>
                                        <div class="notification-date">Aujourd'hui</div>
                                    </div>
                                    <div class="notification-item info">
                                        <div class="notification-title">üí° Conseil fiscal</div>
                                        <div class="notification-text">Optimisez vos charges d√©ductibles avant fin d'ann√©e</div>
                                        <div class="notification-date">Il y a 1 heure</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Stats -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©sum√© rapide</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Factures √©mises</span>
                                        <span style="font-weight: 600;">28</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Factures pay√©es</span>
                                        <span style="font-weight: 600; color: var(--success);">25</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>En attente</span>
                                        <span style="font-weight: 600; color: var(--warning);">3</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Taux de recouvrement</span>
                                        <span style="font-weight: 600;">89%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Espace Client View -->
                <div id="viewEspaceClient" class="view hidden">
                    <div class="card">
                        <div class="card-title" style="margin-bottom: 2rem;">Informations de l'entreprise</div>
                        
                        <form id="clientInfoForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Nom de l'entreprise</label>
                                    <input type="text" class="form-input" id="companyName" value="Entreprise ABC">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">SIRET</label>
                                    <input type="text" class="form-input" id="companySIRET" value="123 456 789 00012">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Forme juridique</label>
                                    <select class="form-select" id="companyType">
                                        <option value="SARL">SARL</option>
                                        <option value="SAS">SAS</option>
                                        <option value="EURL">EURL</option>
                                        <option value="SCI">SCI</option>
                                        <option value="Auto-entrepreneur">Auto-entrepreneur</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">R√©gime fiscal</label>
                                    <select class="form-select" id="fiscalRegime">
                                        <option value="IS">Imp√¥t sur les soci√©t√©s (IS)</option>
                                        <option value="IR">Imp√¥t sur le revenu (IR)</option>
                                        <option value="Micro">R√©gime micro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">TVA</label>
                                    <select class="form-select" id="tvaRegime">
                                        <option value="normale">R√©gime normal</option>
                                        <option value="simplifie">R√©gime simplifi√©</option>
                                        <option value="franchise">Franchise en base</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">P√©riodicit√© TVA</label>
                                    <select class="form-select" id="tvaPeriod">
                                        <option value="mensuelle">Mensuelle (le 21)</option>
                                        <option value="trimestrielle">Trimestrielle (le 24)</option>
                                        <option value="annuelle">Annuelle</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1rem;">
                                <label class="form-label">Adresse</label>
                                <input type="text" class="form-input" id="companyAddress" value="123 Rue de la R√©publique, 75001 Paris">
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" id="companyEmail" value="contact@entreprise-abc.fr">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√©l√©phone</label>
                                    <input type="tel" class="form-input" id="companyPhone" value="+33 1 23 45 67 89">
                                </div>
                            </div>

                            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                                <div class="card-title" style="margin-bottom: 1rem;">Informations bancaires</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">IBAN</label>
                                        <input type="text" class="form-input" id="companyIBAN" value="FR76 1234 5678 9012 3456 7890 123">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">BIC</label>
                                        <input type="text" class="form-input" id="companyBIC" value="BNPAFRPPXXX">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" style="margin-top: 2rem;">Enregistrer les modifications</button>
                        </form>
                    </div>

                    <!-- User Management (Admin only) -->
                    <div class="card" id="userManagementSection" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Gestion des utilisateurs</div>
                            <button class="btn btn-primary" onclick="showAddUserModal()">+ Ajouter un utilisateur</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Niveau d'acc√®s</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersList">
                                <tr>
                                    <td>Jean Dupont</td>
                                    <td>jean.dupont@entreprise-abc.fr</td>
                                    <td><span class="badge badge-success">Admin</span></td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Marie Martin</td>
                                    <td>marie.martin@entreprise-abc.fr</td>
                                    <td><span class="badge badge-warning">Comptable</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="editUser(2)">Modifier</button></td>
                                </tr>
                                <tr>
                                    <td>Pierre Dubois</td>
                                    <td>pierre.dubois@entreprise-abc.fr</td>
                                    <td><span class="badge">Consultation</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="editUser(3)">Modifier</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Other views will be added here -->
                <div id="viewTresorerie" class="view hidden">
                    <div class="card">
                        <div class="card-title">Tr√©sorerie d√©taill√©e</div>
                        <p style="color: var(--text-gray); margin-top: 1rem;">Contenu de la vue tr√©sorerie...</p>
                    </div>
                </div>

                <div id="viewFactures" class="view hidden">
                    <div class="card">
                        <div class="card-title">Gestion des factures</div>
                        <p style="color: var(--text-gray); margin-top: 1rem;">Contenu de la vue factures...</p>
                    </div>
                </div>

                <div id="viewImport" class="view hidden">
                    <div class="card">
                        <div class="card-title">Import de donn√©es</div>
                        <p style="color: var(--text-gray); margin-top: 1rem;">Contenu de la vue import...</p>
                    </div>
                </div>

                <div id="viewAlertes" class="view hidden">
                    <div class="card">
                        <div class="card-title">Alertes et notifications</div>
                        <p style="color: var(--text-gray); margin-top: 1rem;">Contenu de la vue alertes...</p>
                    </div>
                </div>

                <div id="viewAnalyse" class="view hidden">
                    <div class="card">
                        <div class="card-title">Analyse fiscale</div>
                        <p style="color: var(--text-gray); margin-top: 1rem;">Contenu de la vue analyse...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ajouter un utilisateur</div>
                <button class="modal-close" onclick="hideAddUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Niveau d'acc√®s</label>
                        <select class="form-select" required>
                            <option value="">S√©lectionner...</option>
                            <option value="admin">Admin - Acc√®s complet</option>
                            <option value="comptable">Comptable - Factures, tr√©sorerie, fiscalit√©</option>
                            <option value="consultation">Consultation - Lecture seule</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Ajouter</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'https://optimis-fiscale-production.up.railway.app';
        let currentUser = {
            name: 'Jean Dupont',
            company: 'Entreprise ABC',
            accessLevel: 'admin' // admin, comptable, consultation
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            initChart();
            loadNotifications();
            checkAccessLevel();
            
            // Check auth token
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.href = 'login.html'; // Redirect to login page
            }
        });

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('fr-FR', options);
        }

        // Switch view
        function switchView(view) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Update page title
            const titles = {
                'dashboard': 'Tableau de bord',
                'tresorerie': 'Tr√©sorerie',
                'factures': 'Factures',
                'import': 'Import',
                'alertes': 'Alertes',
                'analyse': 'Analyse fiscale',
                'espace-client': 'Espace client'
            };
            document.getElementById('pageTitle').textContent = titles[view] || 'Dashboard';

            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));

            // Show selected view
            const viewMap = {
                'dashboard': 'viewDashboard',
                'tresorerie': 'viewTresorerie',
                'factures': 'viewFactures',
                'import': 'viewImport',
                'alertes': 'viewAlertes',
                'analyse': 'viewAnalyse',
                'espace-client': 'viewEspaceClient'
            };

            const viewId = viewMap[view];
            if (viewId) {
                document.getElementById(viewId).classList.remove('hidden');
            }
        }

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('tresorerieChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['14 D√©c', '15 D√©c', '16 D√©c', '17 D√©c', '18 D√©c', '19 D√©c', '20 D√©c'],
                    datasets: [{
                        label: 'Tr√©sorerie',
                        data: [45000, 46200, 45800, 47000, 46500, 47800, 48250],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Load notifications based on company type and date
        function loadNotifications() {
            const now = new Date();
            const day = now.getDate();
            const notificationsList = document.getElementById('notificationsList');
            
            // Get company info
            const tvaRegime = document.getElementById('tvaPeriod')?.value || 'mensuelle';
            
            // Add automatic notifications based on date
            let notifications = [];
            
            // TVA notification (21st or 24th depending on regime)
            if (tvaRegime === 'trimestrielle' && day >= 20 && day <= 24) {
                notifications.push({
                    type: 'danger',
                    title: '‚ö†Ô∏è TVA trimestrielle',
                    text: 'D√©claration TVA √† soumettre avant le 24 de ce mois',
                    date: 'Urgent'
                });
            } else if (tvaRegime === 'mensuelle' && day >= 17 && day <= 21) {
                notifications.push({
                    type: 'danger',
                    title: '‚ö†Ô∏è TVA mensuelle',
                    text: 'D√©claration TVA √† soumettre avant le 21 de ce mois',
                    date: 'Urgent'
                });
            }
            
            // Keep existing notifications
            // (would load from backend in production)
        }

        // Check access level and hide/show sections
        function checkAccessLevel() {
            const accessLevel = currentUser.accessLevel;
            
            // Update badge
            const badge = document.getElementById('userAccessLevel');
            const accessLabels = {
                'admin': 'Admin',
                'comptable': 'Comptable',
                'consultation': 'Consultation'
            };
            badge.textContent = accessLabels[accessLevel];
            
            // Show/hide user management section
            const userMgmt = document.getElementById('userManagementSection');
            if (accessLevel !== 'admin' && userMgmt) {
                userMgmt.style.display = 'none';
            }
            
            // Disable editing for consultation users
            if (accessLevel === 'consultation') {
                document.querySelectorAll('.form-input, .form-select').forEach(input => {
                    input.disabled = true;
                });
                document.querySelectorAll('.btn-primary').forEach(btn => {
                    btn.style.display = 'none';
                });
            }
        }

        // Modal functions
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('active');
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.remove('active');
        }

        function editUser(userId) {
            alert('Edit user ' + userId);
        }

        // Logout
        function handleLogout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        // Save client info
        document.getElementById('clientInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Informations enregistr√©es avec succ√®s !');
        });

        // Add user
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Utilisateur ajout√© avec succ√®s !');
            hideAddUserModal();
        });
    </script>
</body>
</html>
