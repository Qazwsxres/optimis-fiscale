<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUMMA - Dashboard</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-info {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-role {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .user-role-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--bg-light);
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .nav-menu {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            color: var(--text-gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
            font-size: 0.9375rem;
        }

        .nav-item:hover {
            background: var(--bg-light);
            color: var(--primary);
        }

        .nav-item.active {
            background: #eff6ff;
            color: var(--primary);
            font-weight: 600;
            border-left: 3px solid var(--primary);
        }

        .nav-icon {
            font-size: 1.25rem;
        }

        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .btn-logout {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-dark);
        }

        .btn-logout:hover {
            background: var(--border);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
        }

        .top-bar {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .content-area {
            padding: 2rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .dashboard-left {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .dashboard-right {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-gray);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .stat-change {
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Notifications */
        .notification-item {
            padding: 1rem;
            border-left: 3px solid var(--border);
            margin-bottom: 0.75rem;
            background: var(--bg-light);
            border-radius: 4px;
        }

        .notification-item.warning {
            border-left-color: var(--warning);
            background: #fffbeb;
        }

        .notification-item.danger {
            border-left-color: var(--danger);
            background: #fef2f2;
        }

        .notification-item.info {
            border-left-color: var(--primary);
            background: #eff6ff;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
        }

        .notification-text {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .notification-date {
            font-size: 0.75rem;
            color: var(--text-gray);
            margin-top: 0.5rem;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.9375rem;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            background: var(--bg-light);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-gray);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Form */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9375rem;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 100;
                transition: left 0.3s;
            }

            .sidebar.open {
                left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">N</div>
                    <span>NUMMA</span>
                </div>
            </div>

            <div class="user-info">
                <div class="user-name" id="userName">Jean Dupont</div>
                <div class="user-role" id="userCompany">Entreprise ABC</div>
                <div class="user-role-badge" id="userAccessLevel">Admin</div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" onclick="switchView('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Tableau de bord</span>
                </div>
                <div class="nav-item" onclick="switchView('tresorerie')">
                    <span class="nav-icon">üí∞</span>
                    <span>Tr√©sorerie</span>
                </div>
                <div class="nav-item" onclick="switchView('factures')">
                    <span class="nav-icon">üìÑ</span>
                    <span>Factures</span>
                </div>
                <div class="nav-item" onclick="switchView('rh')">
                    <span class="nav-icon">üë•</span>
                    <span>RH & Paie</span>
                </div>
                <div class="nav-item" onclick="switchView('pointage')">
                    <span class="nav-icon">‚è∞</span>
                    <span>Pointage</span>
                </div>
                <div class="nav-item" onclick="switchView('planning')">
                    <span class="nav-icon">üìÖ</span>
                    <span>Planning</span>
                </div>
                <div class="nav-item" onclick="switchView('import')">
                    <span class="nav-icon">üìÅ</span>
                    <span>Import</span>
                </div>
                <div class="nav-item" onclick="switchView('alertes')">
                    <span class="nav-icon">üîî</span>
                    <span>Alertes</span>
                </div>
                <div class="nav-item" onclick="switchView('analyse')">
                    <span class="nav-icon">üìà</span>
                    <span>Analyse fiscale</span>
                </div>
                <div class="nav-item" onclick="switchView('espace-client')">
                    <span class="nav-icon">üë§</span>
                    <span>Espace client</span>
                </div>

                <div class="nav-item" onclick="switchView('fec')">
                    <span class="nav-icon">üìä</span>
                    <span>FEC / Compta</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" onclick="handleLogout()">üö™ D√©connexion</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div class="page-title" id="pageTitle">Tableau de bord</div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <span id="currentDate"></span>
                </div>
            </div>

            <div class="content-area">
                <!-- Dashboard View -->
                <div id="viewDashboard" class="view">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Tr√©sorerie</div>
                            <div class="stat-value" id="statTresorerie">‚Ç¨ 48,250</div>
                            <div class="stat-change positive">+12%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">√Ä recevoir</div>
                            <div class="stat-value" id="statRecevoir">‚Ç¨ 12,500</div>
                            <div class="stat-change">3 factures</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Revenus (mois)</div>
                            <div class="stat-value" id="statRevenus">‚Ç¨ 25,380</div>
                            <div class="stat-change positive">+8%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prochaine √©ch√©ance</div>
                            <div class="stat-value" style="font-size: 1.25rem;">21 Jan</div>
                            <div class="stat-change">TVA trimestrielle</div>
                        </div>
                    </div>

                    <!-- Main Dashboard Grid -->
                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Tr√©sorerie Chart -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">√âvolution de la tr√©sorerie</div>
                                    <select id="periodSelect" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                        <option value="7">7 jours</option>
                                        <option value="30">30 jours</option>
                                        <option value="90">90 jours</option>
                                    </select>
                                </div>
                                <div class="chart-container">
                                    <canvas id="tresorerieChart"></canvas>
                                </div>
                            </div>

                            <!-- Recent Transactions -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Derni√®res transactions</div>
                                    <button class="btn btn-outline" style="padding: 0.5rem 1rem;" onclick="switchView('tresorerie')">Voir tout</button>
                                </div>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Cat√©gorie</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentTransactions">
                                        <tr>
                                            <td>20 D√©c</td>
                                            <td>Virement client ABC</td>
                                            <td>Vente</td>
                                            <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 2,500</td>
                                        </tr>
                                        <tr>
                                            <td>19 D√©c</td>
                                            <td>Loyer bureau</td>
                                            <td>Charges</td>
                                            <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 1,200</td>
                                        </tr>
                                        <tr>
                                            <td>18 D√©c</td>
                                            <td>Facture fournisseur XYZ</td>
                                            <td>Achat</td>
                                            <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 850</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Notifications / Alertes -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Notifications</div>
                                </div>
                                <div id="notificationsList">
                                    <div class="notification-item danger">
                                        <div class="notification-title">‚ö†Ô∏è TVA √† payer</div>
                                        <div class="notification-text">D√©claration TVA T4 √† soumettre avant le 21 janvier</div>
                                        <div class="notification-date">Dans 2 jours</div>
                                    </div>
                                    <div class="notification-item warning">
                                        <div class="notification-title">üìÑ Facture en retard</div>
                                        <div class="notification-text">Client XYZ - Facture #1234 √©chue depuis 5 jours</div>
                                        <div class="notification-date">Aujourd'hui</div>
                                    </div>
                                    <div class="notification-item info">
                                        <div class="notification-title">üí° Conseil fiscal</div>
                                        <div class="notification-text">Optimisez vos charges d√©ductibles avant fin d'ann√©e</div>
                                        <div class="notification-date">Il y a 1 heure</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Stats -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©sum√© rapide</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Factures √©mises</span>
                                        <span style="font-weight: 600;">28</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Factures pay√©es</span>
                                        <span style="font-weight: 600; color: var(--success);">25</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>En attente</span>
                                        <span style="font-weight: 600; color: var(--warning);">3</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <span>Taux de recouvrement</span>
                                        <span style="font-weight: 600;">89%</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Actions rapides</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <button class="btn btn-primary" onclick="generateCompleteReport()" style="justify-content: center; display: flex; align-items: center; gap: 0.5rem;">
                                        <span>üìä</span>
                                        <span>G√©n√©rer rapport complet</span>
                                    </button>
                                    <button class="btn btn-outline" onclick="contactExpert()" style="justify-content: center; display: flex; align-items: center; gap: 0.5rem;">
                                        <span>üë®‚Äçüíº</span>
                                        <span>Contacter un expert</span>
                                    </button>
                                    <button class="btn btn-outline" onclick="planOptimization()" style="justify-content: center; display: flex; align-items: center; gap: 0.5rem;">
                                        <span>üìÖ</span>
                                        <span>Planifier optimisation</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Espace Client View -->
                <div id="viewEspaceClient" class="view hidden">
                    <div class="card">
                        <div class="card-title" style="margin-bottom: 2rem;">Informations de l'entreprise</div>
                        
                        <form id="clientInfoForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Nom de l'entreprise</label>
                                    <input type="text" class="form-input" id="companyName" value="Entreprise ABC">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">SIRET</label>
                                    <input type="text" class="form-input" id="companySIRET" value="123 456 789 00012">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Forme juridique</label>
                                    <select class="form-select" id="companyType">
                                        <option value="SARL">SARL</option>
                                        <option value="SAS">SAS</option>
                                        <option value="EURL">EURL</option>
                                        <option value="SCI">SCI</option>
                                        <option value="Auto-entrepreneur">Auto-entrepreneur</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">R√©gime fiscal</label>
                                    <select class="form-select" id="fiscalRegime">
                                        <option value="IS">Imp√¥t sur les soci√©t√©s (IS)</option>
                                        <option value="IR">Imp√¥t sur le revenu (IR)</option>
                                        <option value="Micro">R√©gime micro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">TVA</label>
                                    <select class="form-select" id="tvaRegime">
                                        <option value="normale">R√©gime normal</option>
                                        <option value="simplifie">R√©gime simplifi√©</option>
                                        <option value="franchise">Franchise en base</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">P√©riodicit√© TVA</label>
                                    <select class="form-select" id="tvaPeriod">
                                        <option value="mensuelle">Mensuelle (le 21)</option>
                                        <option value="trimestrielle">Trimestrielle (le 24)</option>
                                        <option value="annuelle">Annuelle</option>
                                    </select>
                                </div>
                            </div>
        <!-- FEC Module -->
        <div id="viewFEC" class="view hidden">
            <div class="dashboard-header" style="margin-bottom: 2rem;">
                <div>
                    <h2>üìä FEC - Fichier des √âcritures Comptables</h2>
                    <p style="color: var(--text-gray); margin-top: 0.5rem;">Conforme √† l'Article A47 A-1 du Livre des Proc√©dures Fiscales</p>
                </div>
            </div>

            <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; height: calc(100vh - 200px);">
                <iframe 
                    src="fec-manager.html" 
                    style="width: 100%; height: 100%; border: none; border-radius: 8px;"
                    title="Gestionnaire FEC"
                    id="fecIframe">
                </iframe>
            </div>
        </div>



                            <div class="form-group" style="margin-top: 1rem;">
                                <label class="form-label">Adresse</label>
                                <input type="text" class="form-input" id="companyAddress" value="123 Rue de la R√©publique, 75001 Paris">
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" id="companyEmail" value="contact@entreprise-abc.fr">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√©l√©phone</label>
                                    <input type="tel" class="form-input" id="companyPhone" value="+33 1 23 45 67 89">
                                </div>
                            </div>

                            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                                <div class="card-title" style="margin-bottom: 1rem;">Informations bancaires</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">IBAN</label>
                                        <input type="text" class="form-input" id="companyIBAN" value="FR76 1234 5678 9012 3456 7890 123">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">BIC</label>
                                        <input type="text" class="form-input" id="companyBIC" value="BNPAFRPPXXX">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" style="margin-top: 2rem;">Enregistrer les modifications</button>
                        </form>
                    </div>

                    <!-- User Management (Admin only) -->
                    <div class="card" id="userManagementSection" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Gestion des utilisateurs</div>
                            <button class="btn btn-primary" onclick="showAddUserModal()">+ Ajouter un utilisateur</button>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Niveau d'acc√®s</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersList">
                                <tr>
                                    <td>Jean Dupont</td>
                                    <td><a href="/cdn-cgi/l/email-protection#10636560607f6264507e657d7d713e7662"><span class="__cf_email__" data-cfemail="ee9d9b9e9e819c9aae809b83838fc0889c">[email&#160;protected]</span></a></td>
                                    <td><span class="badge badge-success">Admin</span></td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Marie Martin</td>
                                    <td><a href="/cdn-cgi/l/email-protection#ee9d9b9e9e819c9aae809b83838fc0889c"><span class="__cf_email__" data-cfemail="0c7f797c7c637e784c627961616d226a7e">[email&#160;protected]</span></a></td>
                                    <td><span class="badge badge-warning">Comptable</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="editUser(2)">Modifier</button></td>
                                </tr>
                                <tr>
                                    <td>Pierre Dubois</td>
                                    <td><a href="/cdn-cgi/l/email-protection#8bf8fefbfbe4f9ffcbe5fee6e6eaa5edf9"><span class="__cf_email__" data-cfemail="6b181e1b1b04191f2b051e06060a450d19">[email&#160;protected]</span></a></td>
                                    <td><span class="badge">Consultation</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="editUser(3)">Modifier</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <!-- Pointage View -->
                <div id="viewPointage" class="view hidden">
                    <!-- Top Actions Bar -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700;">Gestion des Pointages</h2>
                        <button class="btn btn-primary" onclick="openEmployeeSettingsModal()">
                            ‚öôÔ∏è Configurer les employ√©s
                        </button>
                    </div>

                    <!-- Top Grid: Clock + Quick Stats -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <!-- Left: Clock In Card -->
                        <div class="card" style="padding: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2rem;">
                                <div>
                                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Pointer</h3>
                                    <p style="color: var(--text-gray); font-size: 0.875rem;" id="liveDate">Chargement...</p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums;" id="liveClock">--:--:--</div>
                                </div>
                            </div>
                            
                            <!-- Employee Selector -->
                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">S√©lectionner l'employ√©</label>
                                <select id="clockEmployeeSelect" class="form-input" style="font-size: 1rem;">
                                    <option value="">-- Choisir un employ√© --</option>
                                </select>
                            </div>
                            
                            <button onclick="clockIn()" class="btn btn-primary" style="width: 100%; padding: 1.25rem; font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
                                <span style="font-size: 1.5rem;">üïê</span>
                                <span>POINTER</span>
                            </button>
                            
                            <div id="clockStatus" style="margin-top: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 8px; text-align: center; font-weight: 500; color: var(--text-gray);">
                                S√©lectionnez un employ√© pour pointer
                            </div>
                        </div>

                        <!-- Right: Today's Status -->
                        <div class="card" style="padding: 2rem;">
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1.5rem;">Aujourd'hui</h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                    <span style="color: var(--text-gray); font-size: 0.875rem;">‚úÖ Pr√©sents</span>
                                    <span style="font-size: 1.5rem; font-weight: 700; color: var(--success);" id="presentCount">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                    <span style="color: var(--text-gray); font-size: 0.875rem;">‚ö†Ô∏è En retard</span>
                                    <span style="font-size: 1.5rem; font-weight: 700; color: var(--warning);" id="lateCount">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                    <span style="color: var(--text-gray); font-size: 0.875rem;">‚ùå Absents</span>
                                    <span style="font-size: 1.5rem; font-weight: 700; color: var(--danger);" id="absentCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- History -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Historique des pointages</div>
                            <button class="btn btn-outline" onclick="exportPointage()">
                                üìä Exporter CSV
                            </button>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <input type="date" class="form-input" id="dateFilter" onchange="filterClocks()" style="flex: 1;">
                            <select class="form-input" id="employeeFilter" onchange="filterClocks()" style="flex: 1;">
                                <option value="">Tous les employ√©s</option>
                            </select>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employ√©</th>
                                    <th>Date</th>
                                    <th>Arriv√©e</th>
                                    <th>D√©part</th>
                                    <th>Dur√©e</th>
                                    <th>Horaire pr√©vu</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody id="clockHistoryTable">
                                <!-- Clock records will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Planning View -->
                <div id="viewPlanning" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">T√¢ches en cours</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--primary);">8</div>
                            <div class="stat-change">3 urgentes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Compl√©t√©es (mois)</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--success);">24</div>
                            <div class="stat-change positive">+6 vs nov.</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">En retard</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--danger);">2</div>
                            <div class="stat-change negative">√Ä traiter</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prochaine √©ch√©ance</div>
                            <div class="stat-value" style="font-size: 1.25rem;">21 Jan</div>
                            <div class="stat-change">TVA T4</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Calendar View -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">üìÖ Calendrier - Janvier 2025</div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-outline" style="padding: 0.5rem 1rem;">‚Üê D√©c</button>
                                        <button class="btn btn-outline" style="padding: 0.5rem 1rem;">F√©v ‚Üí</button>
                                    </div>
                                </div>
                                
                                <!-- Simple Calendar -->
                                <div style="margin-top: 1rem;">
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Lun</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Mar</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Mer</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Jeu</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Ven</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Sam</th>
                                                <th style="padding: 0.75rem; text-align: center; font-size: 0.875rem; color: var(--text-gray); border-bottom: 2px solid var(--border);">Dim</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); color: var(--text-gray);">30</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); color: var(--text-gray);">31</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); font-weight: 600;">1</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">2</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">3</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">4</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">5</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">6</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">7</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">8</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">9</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">10</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">11</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">12</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">13</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">14</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #fef3c7; font-weight: 600;">15<div style="font-size: 0.7rem; margin-top: 0.25rem;">üíº Salaires</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">16</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">17</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">18</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">19</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">20</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #fee2e2; font-weight: 600;">21<div style="font-size: 0.7rem; margin-top: 0.25rem;">üìä TVA</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">22</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">23</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">24</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">25</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light);">26</td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">27</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">28</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #eff6ff; font-weight: 600;">29<div style="font-size: 0.7rem; margin-top: 0.25rem;">ü§ù RDV Expert</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border);">30</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: #fef2f2; font-weight: 600;">31<div style="font-size: 0.7rem; margin-top: 0.25rem;">üìÅ Cl√¥ture</div></td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light); color: var(--text-gray);">1</td>
                                                <td style="padding: 1rem; text-align: center; border: 1px solid var(--border); background: var(--bg-light); color: var(--text-gray);">2</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 8px; display: flex; gap: 1.5rem; font-size: 0.875rem;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 16px; height: 16px; background: #fee2e2; border-radius: 4px;"></div>
                                        <span>Urgent</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 16px; height: 16px; background: #fef3c7; border-radius: 4px;"></div>
                                        <span>Important</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="width: 16px; height: 16px; background: #eff6ff; border-radius: 4px;"></div>
                                        <span>Normal</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Task List -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">üìã T√¢ches</div>
                                    <button class="btn btn-primary" onclick="showAddTaskModal()">+ Nouvelle t√¢che</button>
                                </div>

                                <!-- Filter tabs -->
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid var(--border);">
                                    <button class="btn" onclick="filterTasks('all')" style="background: none; border: none; padding: 1rem 1.5rem; border-bottom: 3px solid var(--primary); color: var(--primary); font-weight: 600; font-size: 0.9375rem;">Toutes (10)</button>
                                    <button class="btn" onclick="filterTasks('in-progress')" style="background: none; border: none; padding: 1rem 1.5rem; border-bottom: 3px solid transparent; color: var(--text-gray); font-size: 0.9375rem;">En cours (8)</button>
                                    <button class="btn" onclick="filterTasks('completed')" style="background: none; border: none; padding: 1rem 1.5rem; border-bottom: 3px solid transparent; color: var(--text-gray); font-size: 0.9375rem;">Compl√©t√©es (24)</button>
                                    <button class="btn" onclick="filterTasks('overdue')" style="background: none; border: none; padding: 1rem 1.5rem; border-bottom: 3px solid transparent; color: var(--danger); font-size: 0.9375rem;">En retard (2)</button>
                                </div>

                                <div id="taskList" style="max-height: 600px; overflow-y: auto;">
                                    <!-- Tasks will be listed here - showing sample format -->
                                    <div style="padding: 1rem; border: 1px solid var(--border); border-left: 4px solid var(--danger); border-radius: 8px; margin-bottom: 1rem; cursor: pointer;" onclick="showTaskDetails(1)">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div style="display: flex; align-items: start; gap: 1rem; flex: 1;">
                                                <input type="checkbox" style="margin-top: 0.25rem;">
                                                <div style="flex: 1;">
                                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">D√©claration TVA T4 2024</div>
                                                    <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.5rem;">
                                                        Pr√©parer et soumettre la d√©claration de TVA pour le dernier trimestre 2024
                                                    </div>
                                                    <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--text-gray);">
                                                        <span>üìÖ 21 Jan 2025</span>
                                                        <span>üë§ Marie Martin</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="badge badge-danger">Urgent</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Upcoming Deadlines -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üéØ Prochaines √©ch√©ances</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="display: flex; gap: 1rem; padding: 1rem; background: #fee2e2; border-radius: 8px; border-left: 3px solid var(--danger);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">21</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">JAN</div>
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">TVA T4 2024</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">D√©claration trimestrielle</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Task Statistics -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üìä Statistiques</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Taux de compl√©tion</div>
                                        <div style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;">75%</div>
                                        <div style="width: 100%; height: 8px; background: white; border-radius: 4px; overflow: hidden;">
                                            <div style="width: 75%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RH & Paie View -->
                <div id="viewRH" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">Employ√©s</div>
                            <div class="stat-value" style="font-size: 1.5rem;">5</div>
                            <div class="stat-change">3 CDI, 2 CDD</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Masse salariale (mois)</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 8,500</div>
                            <div class="stat-change">+5% vs dernier mois</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Charges sociales</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 3,400</div>
                            <div class="stat-change">40% masse salariale</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Fiches √† g√©n√©rer</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--warning);">5</div>
                            <div class="stat-change">Janvier 2025</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Employee List -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">üë• Liste des employ√©s</div>
                                    <button class="btn btn-primary" onclick="showAddEmployeeModal()">+ Nouvel employ√©</button>
                                </div>

                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Poste</th>
                                            <th>Type contrat</th>
                                            <th>Salaire brut</th>
                                            <th>D√©but</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employeesList">
                                        <tr>
                                            <td><strong>Marie Martin</strong></td>
                                            <td>Comptable</td>
                                            <td><span class="badge badge-success">CDI</span></td>
                                            <td>‚Ç¨ 2,400</td>
                                            <td>01/03/2022</td>
                                            <td>
                                                <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewEmployee(1)">Voir</button>
                                                <button class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem; margin-left: 0.5rem;" onclick="generatePayslip(1)">Fiche</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Pierre Dubois</strong></td>
                                            <td>Assistant commercial</td>
                                            <td><span class="badge badge-success">CDI</span></td>
                                            <td>‚Ç¨ 2,000</td>
                                            <td>15/06/2023</td>
                                            <td>
                                                <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewEmployee(2)">Voir</button>
                                                <button class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem; margin-left: 0.5rem;" onclick="generatePayslip(2)">Fiche</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Sophie Laurent</strong></td>
                                            <td>D√©veloppeuse</td>
                                            <td><span class="badge badge-success">CDI</span></td>
                                            <td>‚Ç¨ 2,800</td>
                                            <td>10/09/2021</td>
                                            <td>
                                                <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewEmployee(3)">Voir</button>
                                                <button class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem; margin-left: 0.5rem;" onclick="generatePayslip(3)">Fiche</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Lucas Bernard</strong></td>
                                            <td>Stagiaire Marketing</td>
                                            <td><span class="badge badge-warning">CDD</span></td>
                                            <td>‚Ç¨ 800</td>
                                            <td>01/12/2024</td>
                                            <td>
                                                <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewEmployee(4)">Voir</button>
                                                <button class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem; margin-left: 0.5rem;" onclick="generatePayslip(4)">Fiche</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong>Emma Petit</strong></td>
                                            <td>Designer</td>
                                            <td><span class="badge badge-warning">CDD</span></td>
                                            <td>‚Ç¨ 1,500</td>
                                            <td>01/11/2024</td>
                                            <td>
                                                <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewEmployee(5)">Voir</button>
                                                <button class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem; margin-left: 0.5rem;" onclick="generatePayslip(5)">Fiche</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Payslips History -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">üìÑ Historique des fiches de paie</div>
                                    <button class="btn btn-primary" onclick="generateAllPayslips()">G√©n√©rer toutes (Janvier)</button>
                                </div>

                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Mois</th>
                                            <th>Employ√©</th>
                                            <th>Brut</th>
                                            <th>Net</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>D√©c 2024</td>
                                            <td>Marie Martin</td>
                                            <td>‚Ç¨ 2,400</td>
                                            <td>‚Ç¨ 1,872</td>
                                            <td><span class="badge badge-success">Pay√©e</span></td>
                                            <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="downloadPayslip('dec_2024_marie')">üì• PDF</button></td>
                                        </tr>
                                        <tr>
                                            <td>D√©c 2024</td>
                                            <td>Pierre Dubois</td>
                                            <td>‚Ç¨ 2,000</td>
                                            <td>‚Ç¨ 1,560</td>
                                            <td><span class="badge badge-success">Pay√©e</span></td>
                                            <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="downloadPayslip('dec_2024_pierre')">üì• PDF</button></td>
                                        </tr>
                                        <tr>
                                            <td>D√©c 2024</td>
                                            <td>Sophie Laurent</td>
                                            <td>‚Ç¨ 2,800</td>
                                            <td>‚Ç¨ 2,184</td>
                                            <td><span class="badge badge-success">Pay√©e</span></td>
                                            <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="downloadPayslip('dec_2024_sophie')">üì• PDF</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Quick Actions -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">‚ö° Actions rapides</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <button class="btn btn-primary" onclick="generateAllPayslips()">üìÑ G√©n√©rer fiches janvier</button>
                                    <button class="btn btn-outline" onclick="exportDSN()">üìä Export DSN</button>
                                    <button class="btn btn-outline" onclick="calculateCharges()">üí∞ Calcul charges sociales</button>
                                    <button class="btn btn-outline" onclick="manageLeaves()">üèñÔ∏è G√©rer les cong√©s</button>
                                </div>
                            </div>

                            <!-- Charges Breakdown -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üíº Charges sociales</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                                            <span>URSSAF</span>
                                            <span style="font-weight: 600;">‚Ç¨ 2,040</span>
                                        </div>
                                        <div style="width: 100%; height: 6px; background: var(--bg-light); border-radius: 3px; overflow: hidden;">
                                            <div style="width: 60%; height: 100%; background: var(--primary);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                                            <span>Retraite</span>
                                            <span style="font-weight: 600;">‚Ç¨ 850</span>
                                        </div>
                                        <div style="width: 100%; height: 6px; background: var(--bg-light); border-radius: 3px; overflow: hidden;">
                                            <div style="width: 25%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                                            <span>Pr√©voyance</span>
                                            <span style="font-weight: 600;">‚Ç¨ 340</span>
                                        </div>
                                        <div style="width: 100%; height: 6px; background: var(--bg-light); border-radius: 3px; overflow: hidden;">
                                            <div style="width: 10%; height: 100%; background: var(--warning);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                                            <span>Mutuelle</span>
                                            <span style="font-weight: 600;">‚Ç¨ 170</span>
                                        </div>
                                        <div style="width: 100%; height: 6px; background: var(--bg-light); border-radius: 3px; overflow: hidden;">
                                            <div style="width: 5%; height: 100%; background: #8b5cf6;"></div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 0.5rem; padding-top: 0.75rem; border-top: 2px solid var(--border);">
                                        <div style="display: flex; justify-content: space-between; font-weight: 600;">
                                            <span>Total</span>
                                            <span style="color: var(--primary);">‚Ç¨ 3,400</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Upcoming Payments -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üìÖ Prochains paiements</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="padding: 1rem; background: #fef3c7; border-radius: 8px; border-left: 3px solid var(--warning);">
                                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Salaires janvier</div>
                                        <div style="font-size: 0.875rem; color: var(--text-gray);">15 janvier 2025</div>
                                        <div style="font-weight: 600; margin-top: 0.5rem; color: var(--text-dark);">‚Ç¨ 8,500</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px; border-left: 3px solid var(--primary);">
                                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Charges URSSAF</div>
                                        <div style="font-size: 0.875rem; color: var(--text-gray);">15 janvier 2025</div>
                                        <div style="font-weight: 600; margin-top: 0.5rem; color: var(--text-dark);">‚Ç¨ 2,040</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Leave Balance -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">üèñÔ∏è Solde des cong√©s</div>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.875rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-light); border-radius: 6px;">
                                        <span>Marie Martin</span>
                                        <span style="font-weight: 600;">18 jours</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-light); border-radius: 6px;">
                                        <span>Pierre Dubois</span>
                                        <span style="font-weight: 600;">22 jours</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-light); border-radius: 6px;">
                                        <span>Sophie Laurent</span>
                                        <span style="font-weight: 600;">15 jours</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-light); border-radius: 6px;">
                                        <span>Lucas Bernard</span>
                                        <span style="font-weight: 600;">5 jours</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-light); border-radius: 6px;">
                                        <span>Emma Petit</span>
                                        <span style="font-weight: 600;">8 jours</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other views will be added here -->
                <!-- Tr√©sorerie View -->
                <div id="viewTresorerie" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">Solde actuel</div>
                            <div class="stat-value">‚Ç¨ 48,250</div>
                            <div class="stat-change positive">+12% ce mois</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Entr√©es (30j)</div>
                            <div class="stat-value" style="color: var(--success);">‚Ç¨ 35,600</div>
                            <div class="stat-change">18 transactions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Sorties (30j)</div>
                            <div class="stat-value" style="color: var(--danger);">‚Ç¨ 28,400</div>
                            <div class="stat-change">24 transactions</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Full Cashflow Chart -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">√âvolution de la tr√©sorerie</div>
                                    <div style="display: flex; gap: 1rem;">
                                        <select id="cashflowPeriod" onchange="updateCashflowChart()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                            <option value="7">7 jours</option>
                                            <option value="30" selected>30 jours</option>
                                            <option value="90">90 jours</option>
                                            <option value="365">1 an</option>
                                        </select>
                                        <button class="btn btn-outline" style="padding: 0.5rem 1rem;" onclick="refreshCashflow()">üîÑ Actualiser</button>
                                    </div>
                                </div>
                                <div class="chart-container" style="height: 400px;">
                                    <canvas id="cashflowFullChart"></canvas>
                                </div>
                            </div>

                            <!-- All Transactions -->
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">Toutes les transactions</div>
                                    <div style="display: flex; gap: 1rem;">
                                        <select id="filterCategory" onchange="filterTransactions()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                            <option value="all">Toutes cat√©gories</option>
                                            <option value="vente">Ventes</option>
                                            <option value="achat">Achats</option>
                                            <option value="charge">Charges</option>
                                            <option value="salaire">Salaires</option>
                                            <option value="taxe">Taxes</option>
                                        </select>
                                        <input type="text" id="searchTransaction" placeholder="Rechercher..." style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); min-width: 200px;">
                                    </div>
                                </div>
                                <div style="max-height: 500px; overflow-y: auto;">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Description</th>
                                                <th>Cat√©gorie</th>
                                                <th>Montant</th>
                                                <th>Solde</th>
                                            </tr>
                                        </thead>
                                        <tbody id="allTransactionsBody">
                                            <tr>
                                                <td>20 D√©c 2024</td>
                                                <td>Virement client ABC - Facture F-2024-001</td>
                                                <td><span class="badge">Vente</span></td>
                                                <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 2,500.00</td>
                                                <td>‚Ç¨ 48,250.00</td>
                                            </tr>
                                            <tr>
                                                <td>19 D√©c 2024</td>
                                                <td>Loyer bureau - D√©cembre</td>
                                                <td><span class="badge">Charge</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 1,200.00</td>
                                                <td>‚Ç¨ 45,750.00</td>
                                            </tr>
                                            <tr>
                                                <td>18 D√©c 2024</td>
                                                <td>Facture fournisseur XYZ - Mat√©riel</td>
                                                <td><span class="badge">Achat</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 850.00</td>
                                                <td>‚Ç¨ 46,950.00</td>
                                            </tr>
                                            <tr>
                                                <td>17 D√©c 2024</td>
                                                <td>Virement client DEF - Facture F-2024-002</td>
                                                <td><span class="badge">Vente</span></td>
                                                <td style="color: var(--success); font-weight: 600;">+‚Ç¨ 3,200.00</td>
                                                <td>‚Ç¨ 47,800.00</td>
                                            </tr>
                                            <tr>
                                                <td>15 D√©c 2024</td>
                                                <td>Salaires - √âquipe</td>
                                                <td><span class="badge">Salaire</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 8,500.00</td>
                                                <td>‚Ç¨ 44,600.00</td>
                                            </tr>
                                            <tr>
                                                <td>14 D√©c 2024</td>
                                                <td>TVA T3 - Paiement</td>
                                                <td><span class="badge">Taxe</span></td>
                                                <td style="color: var(--danger); font-weight: 600;">-‚Ç¨ 4,200.00</td>
                                                <td>‚Ç¨ 53,100.00</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Forecast -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Pr√©visions 30 jours</div>
                                <div class="chart-container" style="height: 250px;">
                                    <canvas id="forecastChart"></canvas>
                                </div>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span style="color: var(--text-gray);">Solde estim√© (30j)</span>
                                        <span style="font-weight: 600;">‚Ç¨ 52,100</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: var(--text-gray);">Variation</span>
                                        <span style="font-weight: 600; color: var(--success);">+‚Ç¨ 3,850 (+8%)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Categories Breakdown -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©partition par cat√©gorie</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Ventes</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--success);">‚Ç¨ 15,800</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 55%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Salaires</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 8,500</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 30%; height: 100%; background: var(--danger);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Achats</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 4,200</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 15%; height: 100%; background: var(--warning);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Charges</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 3,100</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 11%; height: 100%; background: var(--primary);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.875rem;">Taxes</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">‚Ç¨ 4,200</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 15%; height: 100%; background: #8b5cf6;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Export -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Export des donn√©es</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <button class="btn btn-outline" onclick="exportCSV()">üìä Export CSV</button>
                                    <button class="btn btn-outline" onclick="exportPDF()">üìÑ Export PDF</button>
                                    <button class="btn btn-outline" onclick="exportExcel()">üìó Export Excel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Factures View -->
                <div id="viewFactures" class="view hidden">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Gestion des factures</div>
                            <button class="btn btn-primary" onclick="showCreateInvoiceModal()">+ Nouvelle facture</button>
                        </div>
                        
                        <!-- Filters -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <select id="filterStatus" onchange="filterInvoices()" style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border);">
                                <option value="all">Tous les statuts</option>
                                <option value="draft">Brouillon</option>
                                <option value="sent">Envoy√©e</option>
                                <option value="paid">Pay√©e</option>
                                <option value="overdue">En retard</option>
                            </select>
                            <input type="text" id="searchInvoice" placeholder="Rechercher..." style="padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border); flex: 1; min-width: 200px;">
                        </div>

                        <!-- Invoices Table -->
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>N¬∞ Facture</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>√âch√©ance</th>
                                    <th>Montant HT</th>
                                    <th>Montant TTC</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoicesTableBody">
                                <tr>
                                    <td><strong>F-2024-001</strong></td>
                                    <td>Client ABC</td>
                                    <td>15 D√©c 2024</td>
                                    <td>15 Jan 2025</td>
                                    <td>‚Ç¨ 2,000.00</td>
                                    <td>‚Ç¨ 2,400.00</td>
                                    <td><span class="badge badge-success">Pay√©e</span></td>
                                    <td>
                                        <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewInvoice(1)">Voir</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>F-2024-002</strong></td>
                                    <td>Client XYZ</td>
                                    <td>18 D√©c 2024</td>
                                    <td>18 Jan 2025</td>
                                    <td>‚Ç¨ 1,500.00</td>
                                    <td>‚Ç¨ 1,800.00</td>
                                    <td><span class="badge badge-warning">Envoy√©e</span></td>
                                    <td>
                                        <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewInvoice(2)">Voir</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>F-2024-003</strong></td>
                                    <td>Entreprise DEF</td>
                                    <td>10 D√©c 2024</td>
                                    <td>10 Jan 2025</td>
                                    <td>‚Ç¨ 850.00</td>
                                    <td>‚Ç¨ 1,020.00</td>
                                    <td><span class="badge badge-danger">En retard</span></td>
                                    <td>
                                        <button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewInvoice(3)">Voir</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Invoice Statistics -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                        <div class="card">
                            <div class="stat-label">Total factur√©</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 25,380</div>
                        </div>
                        <div class="card">
                            <div class="stat-label">En attente</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--warning);">‚Ç¨ 12,500</div>
                        </div>
                        <div class="card">
                            <div class="stat-label">Pay√©es</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--success);">‚Ç¨ 10,200</div>
                        </div>
                        <div class="card">
                            <div class="stat-label">En retard</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--danger);">‚Ç¨ 2,680</div>
                        </div>
                    </div>
                </div>

                <!-- Import View -->
                <div id="viewImport" class="view hidden">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-title" style="margin-bottom: 0.5rem;">Import de donn√©es</div>
                        <p style="color: var(--text-gray); margin-bottom: 2rem;">Importez vos donn√©es bancaires, factures et documents comptables. Formats accept√©s: CSV, PDF, XLSX</p>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                            <!-- Bank Transactions -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìä Transactions bancaires</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('bankFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="bankFile" accept=".csv,.pdf" style="display: none;" onchange="handleBankUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV ou PDF accept√©s</div>
                                </div>
                                <div id="bankUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">18 D√©c 2024 - 30 transactions</div>
                                </div>
                            </div>

                            <!-- Sales Invoices -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìÑ Factures de vente</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('salesFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="salesFile" accept=".csv,.xlsx,.pdf" style="display: none;" onchange="handleSalesUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV, XLSX ou PDF accept√©s</div>
                                </div>
                                <div id="salesUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">15 D√©c 2024 - 25 factures</div>
                                </div>
                            </div>

                            <!-- Purchase Invoices -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìã Factures fournisseurs</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('purchaseFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="purchaseFile" accept=".csv,.xlsx,.pdf" style="display: none;" onchange="handlePurchaseUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV, XLSX ou PDF accept√©s</div>
                                </div>
                                <div id="purchaseUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">16 D√©c 2024 - 18 factures</div>
                                </div>
                            </div>

                            <!-- Trial Balance -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìà Balance comptable</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('trialBalanceFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="trialBalanceFile" accept=".csv,.pdf" style="display: none;" onchange="handleTrialBalanceUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez un fichier</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">CSV ou PDF accept√©s</div>
                                </div>
                                <div id="trialBalanceUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem;">
                                    <a href="#" onclick="downloadSampleBalance(); return false;" style="color: var(--primary); text-decoration: underline; font-size: 0.875rem;">
                                        üì• T√©l√©charger un exemple de fichier
                                    </a>
                                </div>
                            </div>

                            <!-- General Documents -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üìé Documents divers</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('generalDocsFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="generalDocsFile" accept=".pdf,.csv,.xlsx,.doc,.docx" multiple style="display: none;" onchange="handleGeneralDocsUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez des fichiers</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">Tous formats accept√©s (PDF, CSV, XLSX, DOC)</div>
                                    <div style="font-size: 0.75rem; color: var(--text-gray); margin-top: 0.5rem;">S√©lection multiple possible</div>
                                </div>
                                <div id="generalDocsUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Documents stock√©s:</div>
                                    <div style="color: var(--text-gray);">12 fichiers</div>
                                </div>
                            </div>

                            <!-- Tax Documents -->
                            <div class="card" style="background: var(--bg-light);">
                                <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üèõÔ∏è Documents fiscaux</h3>
                                <div class="file-upload-zone" onclick="document.getElementById('taxDocsFile').click()" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.2s;">
                                    <input type="file" id="taxDocsFile" accept=".pdf,.csv" multiple style="display: none;" onchange="handleTaxDocsUpload(event)">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìÅ</div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Cliquez ou glissez des fichiers</div>
                                    <div style="font-size: 0.875rem; color: var(--text-gray);">D√©clarations TVA, liasses fiscales, etc.</div>
                                </div>
                                <div id="taxDocsUploadStatus" class="hidden" style="margin-top: 1rem;"></div>
                                <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; font-size: 0.875rem;">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Derni√®re importation:</div>
                                    <div style="color: var(--text-gray);">01 D√©c 2024 - D√©claration TVA T3</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Import History -->
                    <div class="card">
                        <div class="card-title" style="margin-bottom: 1.5rem;">Historique des imports</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Fichier</th>
                                    <th>Format</th>
                                    <th>Enregistrements</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="importHistoryTable">
                                <tr>
                                    <td>18 D√©c 2024 14:30</td>
                                    <td>Transactions bancaires</td>
                                    <td>relev√©_decembre.csv</td>
                                    <td><span class="badge">CSV</span></td>
                                    <td>30</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(1)">Voir</button></td>
                                </tr>
                                <tr>
                                    <td>16 D√©c 2024 09:15</td>
                                    <td>Factures fournisseurs</td>
                                    <td>factures_t4.pdf</td>
                                    <td><span class="badge" style="background: #fee2e2; color: #991b1b;">PDF</span></td>
                                    <td>18</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(2)">Voir</button></td>
                                </tr>
                                <tr>
                                    <td>15 D√©c 2024 16:45</td>
                                    <td>Factures de vente</td>
                                    <td>ventes_decembre.xlsx</td>
                                    <td><span class="badge" style="background: #d1fae5; color: #065f46;">XLSX</span></td>
                                    <td>25</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(3)">Voir</button></td>
                                </tr>
                                <tr>
                                    <td>01 D√©c 2024 10:20</td>
                                    <td>Documents fiscaux</td>
                                    <td>declaration_tva_t3.pdf</td>
                                    <td><span class="badge" style="background: #fee2e2; color: #991b1b;">PDF</span></td>
                                    <td>1</td>
                                    <td><span class="badge badge-success">R√©ussi</span></td>
                                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails(4)">Voir</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Help Section -->
                    <div class="card" style="background: #eff6ff; border: 1px solid var(--primary);">
                        <div style="display: flex; gap: 1rem;">
                            <div style="font-size: 2rem;">üí°</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--primary);">Besoin d'aide pour l'import ?</div>
                                <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 1rem;">
                                    <strong>Formats support√©s:</strong>
                                    <ul style="margin: 0.5rem 0 0 1.5rem; line-height: 1.8;">
                                        <li><strong>CSV</strong> - Donn√©es structur√©es (transactions, factures)</li>
                                        <li><strong>PDF</strong> - Documents scann√©s (relev√©s bancaires, factures, d√©clarations)</li>
                                        <li><strong>XLSX</strong> - Tableaux Excel (exports comptables)</li>
                                    </ul>
                                    Notre syst√®me extrait automatiquement les donn√©es des PDF gr√¢ce √† l'OCR.
                                </div>
                                <button class="btn btn-primary" style="padding: 0.5rem 1rem;">üìñ Voir le guide complet</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alertes View -->
                <div id="viewAlertes" class="view hidden">
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">Alertes et notifications</div>
                            <button class="btn btn-outline" onclick="markAllAlertsRead()">‚úì Tout marquer comme lu</button>
                        </div>

                        <!-- Filter -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center;">
                            <select id="filterAlertType" onchange="filterAlerts()" style="padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); font-size: 0.9375rem; min-width: 150px;">
                                <option value="all">Conseils</option>
                                <option value="fiscal">Fiscal</option>
                                <option value="invoice">Factures</option>
                                <option value="cash">Tr√©sorerie</option>
                                <option value="advice">Tous</option>
                            </select>
                            <select id="filterAlertPriority" onchange="filterAlerts()" style="padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); font-size: 0.9375rem; min-width: 150px;">
                                <option value="all">Moyenne</option>
                                <option value="high">Urgente</option>
                                <option value="medium">Moyenne</option>
                                <option value="low">Faible</option>
                            </select>
                            <button class="btn btn-outline" onclick="markAllAlertsRead()" style="margin-left: auto; padding: 0.75rem 1.5rem;">‚úì Tout marquer comme lu</button>
                        </div>
                    </div>

                    <!-- Urgent Alerts -->
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-title" style="margin-bottom: 1rem; color: var(--danger);">‚ö†Ô∏è Alertes urgentes</div>
                        <div id="urgentAlerts">
                            <div class="notification-item danger" style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                                    <div style="flex: 1;">
                                        <div class="notification-title">TVA trimestrielle √† d√©clarer</div>
                                        <div class="notification-text">La d√©claration de TVA du T4 2024 doit √™tre soumise avant le 24 janvier 2025. Montant estim√©: ‚Ç¨ 4,200</div>
                                        <div class="notification-date">√âch√©ance dans 4 jours</div>
                                    </div>
                                    <button class="btn btn-primary" style="padding: 0.75rem 1.5rem; white-space: nowrap;" onclick="handleTVADeclaration()">Traiter</button>
                                </div>
                            </div>

                            <div class="notification-item danger" style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                                    <div style="flex: 1;">
                                        <div class="notification-title">Factures en retard de paiement</div>
                                        <div class="notification-text">3 factures sont en retard de paiement pour un montant total de ‚Ç¨ 2,680. Relance recommand√©e.</div>
                                        <div class="notification-date">Retard moyen: 8 jours</div>
                                    </div>
                                    <button class="btn btn-outline" style="padding: 0.75rem 1.5rem; white-space: nowrap;" onclick="switchView('factures')">Voir</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Recent Alerts -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Toutes les alertes</div>
                                <div id="allAlerts">
                                    <div class="notification-item warning">
                                        <div class="notification-title">üí° Optimisation fiscale sugg√©r√©e</div>
                                        <div class="notification-text">Vous pouvez d√©duire jusqu'√† ‚Ç¨ 1,500 de charges suppl√©mentaires avant la fin de l'exercice. Consultez l'analyse fiscale pour plus de d√©tails.</div>
                                        <div class="notification-date">Aujourd'hui √† 10:30</div>
                                    </div>

                                    <div class="notification-item info">
                                        <div class="notification-title">üìä Rapport mensuel disponible</div>
                                        <div class="notification-text">Votre rapport de tr√©sorerie pour d√©cembre 2024 est maintenant disponible. Revenus: +8% vs novembre.</div>
                                        <div class="notification-date">Aujourd'hui √† 09:00</div>
                                    </div>

                                    <div class="notification-item warning">
                                        <div class="notification-title">üí∞ Tr√©sorerie pr√©visionnelle</div>
                                        <div class="notification-text">Votre solde de tr√©sorerie pourrait descendre sous ‚Ç¨ 30,000 fin janvier en raison des paiements TVA et salaires.</div>
                                        <div class="notification-date">Hier √† 16:45</div>
                                    </div>

                                    <div class="notification-item info">
                                        <div class="notification-title">‚úÖ Import r√©ussi</div>
                                        <div class="notification-text">30 transactions bancaires ont √©t√© import√©es avec succ√®s depuis votre fichier relev√©_decembre.csv</div>
                                        <div class="notification-date">18 D√©c √† 14:30</div>
                                    </div>

                                    <div class="notification-item warning">
                                        <div class="notification-title">üìÑ Facture bient√¥t √©chue</div>
                                        <div class="notification-text">La facture F-2024-002 (Client XYZ - ‚Ç¨ 1,800) arrive √† √©ch√©ance dans 7 jours.</div>
                                        <div class="notification-date">18 D√©c √† 09:00</div>
                                    </div>

                                    <div class="notification-item info">
                                        <div class="notification-title">üéØ Objectif mensuel atteint</div>
                                        <div class="notification-text">F√©licitations ! Vous avez atteint votre objectif de chiffre d'affaires pour d√©cembre (‚Ç¨ 25,000)</div>
                                        <div class="notification-date">17 D√©c √† 18:20</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Alert Statistics -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Statistiques</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Alertes non lues</div>
                                        <div style="font-size: 1.75rem; font-weight: 700; color: var(--danger);">5</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Urgentes</div>
                                        <div style="font-size: 1.75rem; font-weight: 700; color: var(--warning);">2</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Cette semaine</div>
                                        <div style="font-size: 1.75rem; font-weight: 700;">12</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Alert Types -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Par type</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üìä</span>
                                            <span>Fiscal</span>
                                        </div>
                                        <span style="font-weight: 600;">3</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üìÑ</span>
                                            <span>Factures</span>
                                        </div>
                                        <span style="font-weight: 600;">4</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üí∞</span>
                                            <span>Tr√©sorerie</span>
                                        </div>
                                        <span style="font-weight: 600;">2</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üí°</span>
                                            <span>Conseils</span>
                                        </div>
                                        <span style="font-weight: 600;">3</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Calendar -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Prochaines √©ch√©ances</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <div style="display: flex; gap: 1rem; padding: 0.75rem; background: #fef2f2; border-radius: 8px; border-left: 3px solid var(--danger);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">24</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">JAN</div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">TVA T4</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">‚Ç¨ 4,200</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 1rem; padding: 0.75rem; background: #fffbeb; border-radius: 8px; border-left: 3px solid var(--warning);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">31</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">JAN</div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Cl√¥ture exercice</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">Fiscal 2024</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 1rem; padding: 0.75rem; background: var(--bg-light); border-radius: 8px; border-left: 3px solid var(--primary);">
                                        <div style="text-align: center; min-width: 50px;">
                                            <div style="font-size: 1.5rem; font-weight: 700;">15</div>
                                            <div style="font-size: 0.75rem; color: var(--text-gray);">F√âV</div>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Paiement salaires</div>
                                            <div style="font-size: 0.875rem; color: var(--text-gray);">‚Ç¨ 8,500</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analyse Fiscale View -->
                <div id="viewAnalyse" class="view hidden">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-label">Imp√¥t estim√© 2024</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 18,500</div>
                            <div class="stat-change">IS √† 25%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">√âconomies possibles</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--success);">‚Ç¨ 3,200</div>
                            <div class="stat-change positive">-17%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Charges d√©ductibles</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Ç¨ 45,600</div>
                            <div class="stat-change">62% du CA</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Score fiscal</div>
                            <div class="stat-value" style="font-size: 1.5rem; color: var(--warning);">72/100</div>
                            <div class="stat-change">Optimisable</div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-left">
                            <!-- Recommendations -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1.5rem;">üéØ Recommandations d'optimisation</div>
                                
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1.5rem; background: #d1fae5; border-radius: 12px; border-left: 4px solid var(--success);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div style="font-weight: 600; font-size: 1.125rem;">Augmentez vos charges d√©ductibles</div>
                                            <span class="badge badge-success">√âconomie: ‚Ç¨ 1,200</span>
                                        </div>
                                        <div style="color: var(--text-gray); margin-bottom: 1rem; line-height: 1.6;">
                                            Vous pouvez d√©duire jusqu'√† ‚Ç¨ 4,000 de charges suppl√©mentaires avant la cl√¥ture. Investissez dans du mat√©riel professionnel, formation, ou logiciels pour optimiser votre fiscalit√©.
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.5rem;"><strong>Actions sugg√©r√©es:</strong></div>
                                        <ul style="margin-left: 1.5rem; color: var(--text-gray); font-size: 0.875rem; line-height: 1.8;">
                                            <li>Achat de mat√©riel informatique avant le 31/12</li>
                                            <li>Investissement dans des formations professionnelles</li>
                                            <li>Abonnements logiciels annuels</li>
                                        </ul>
                                        <button class="btn btn-primary" style="margin-top: 1rem;">En savoir plus</button>
                                    </div>

                                    <div style="padding: 1.5rem; background: #fef3c7; border-radius: 12px; border-left: 4px solid var(--warning);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div style="font-weight: 600; font-size: 1.125rem;">Optimisez vos amortissements</div>
                                            <span class="badge badge-warning">√âconomie: ‚Ç¨ 1,400</span>
                                        </div>
                                        <div style="color: var(--text-gray); margin-bottom: 1rem; line-height: 1.6;">
                                            Certains de vos actifs peuvent b√©n√©ficier d'amortissements acc√©l√©r√©s ou d√©gressifs. Une r√©vision de votre plan d'amortissement pourrait r√©duire votre base imposable.
                                        </div>
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.5rem;"><strong>Actifs concern√©s:</strong></div>
                                        <ul style="margin-left: 1.5rem; color: var(--text-gray); font-size: 0.875rem; line-height: 1.8;">
                                            <li>V√©hicules professionnels (amortissement d√©gressif)</li>
                                            <li>Mat√©riel informatique (dur√©e 3 ans)</li>
                                            <li>Am√©nagements bureau (sur 10 ans)</li>
                                        </ul>
                                        <button class="btn btn-outline" style="margin-top: 1rem;">Consulter un expert</button>
                                    </div>

                                    <div style="padding: 1.5rem; background: #eff6ff; border-radius: 12px; border-left: 4px solid var(--primary);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                            <div style="font-weight: 600; font-size: 1.125rem;">Cr√©dit d'imp√¥t recherche (CIR)</div>
                                            <span class="badge" style="background: #dbeafe; color: var(--primary);">√âconomie: ‚Ç¨ 600</span>
                                        </div>
                                        <div style="color: var(--text-gray); margin-bottom: 1rem; line-height: 1.6;">
                                            Votre activit√© pourrait √™tre √©ligible au cr√©dit d'imp√¥t recherche. Si vous d√©veloppez des produits innovants ou menez des activit√©s de R&D, vous pourriez r√©cup√©rer 30% des d√©penses √©ligibles.
                                        </div>
                                        <button class="btn btn-outline" style="margin-top: 1rem;">V√©rifier l'√©ligibilit√©</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Tax Breakdown -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">R√©partition fiscale 2024</div>
                                <div style="height: 300px;">
                                    <canvas id="taxBreakdownChart"></canvas>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">TVA</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 16,800</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">IS</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 18,500</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Charges sociales</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 28,200</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Autres taxes</div>
                                        <div style="font-size: 1.25rem; font-weight: 700;">‚Ç¨ 2,400</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-right">
                            <!-- Fiscal Score -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Score d'optimisation fiscale</div>
                                <div style="text-align: center; padding: 2rem 0;">
                                    <div style="font-size: 4rem; font-weight: 700; color: var(--warning);">72</div>
                                    <div style="font-size: 1.125rem; color: var(--text-gray); margin-bottom: 1rem;">sur 100</div>
                                    <div style="width: 100%; height: 12px; background: var(--bg-light); border-radius: 6px; overflow: hidden;">
                                        <div style="width: 72%; height: 100%; background: linear-gradient(90deg, var(--warning), var(--success));"></div>
                                    </div>
                                </div>
                                <div style="font-size: 0.875rem; color: var(--text-gray); line-height: 1.6; margin-top: 1rem;">
                                    Votre strat√©gie fiscale est bonne mais optimisable. Suivez nos recommandations pour √©conomiser jusqu'√† ‚Ç¨ 3,200.
                                </div>
                            </div>

                            <!-- Deductibility Analysis -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Analyse de d√©ductibilit√©</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.875rem;">Charges optimales</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--success);">92%</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 92%; height: 100%; background: var(--success);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.875rem;">Amortissements</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--warning);">65%</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 65%; height: 100%; background: var(--warning);"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-size: 0.875rem;">Cr√©dits d'imp√¥t</span>
                                            <span style="font-size: 0.875rem; font-weight: 600; color: var(--danger);">30%</span>
                                        </div>
                                        <div style="width: 100%; height: 8px; background: var(--bg-light); border-radius: 4px; overflow: hidden;">
                                            <div style="width: 30%; height: 100%; background: var(--danger);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Comparison -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Comparaison sectorielle</div>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Taux d'imposition effectif</div>
                                        <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                            <span style="font-size: 1.5rem; font-weight: 700;">18.2%</span>
                                            <span style="font-size: 0.875rem; color: var(--text-gray);">Moyenne: 21.5%</span>
                                        </div>
                                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--success); font-weight: 600;">-3.3% vs secteur ‚úì</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                                        <div style="font-size: 0.875rem; color: var(--text-gray); margin-bottom: 0.25rem;">Charges / CA</div>
                                        <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                            <span style="font-size: 1.5rem; font-weight: 700;">62%</span>
                                            <span style="font-size: 0.875rem; color: var(--text-gray);">Moyenne: 58%</span>
                                        </div>
                                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--warning); font-weight: 600;">+4% vs secteur</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="card">
                                <div class="card-title" style="margin-bottom: 1rem;">Actions rapides</div>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <button class="btn btn-primary" style="justify-content: center;">üìä G√©n√©rer rapport complet</button>
                                    <button class="btn btn-outline" style="justify-content: center;">üë®‚Äçüíº Contacter un expert</button>
                                    <button class="btn btn-outline" style="justify-content: center;">üìÖ Planifier optimisation</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Invoice Modal -->
    <div id="createInvoiceModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">üìÑ Cr√©er une facture</div>
                <button class="modal-close" onclick="hideCreateInvoiceModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="createInvoiceForm" onsubmit="generateInvoice(event)">
                    <!-- Invoice Info -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="form-group">
                            <label class="form-label">N¬∞ Facture</label>
                            <input type="text" class="form-input" id="invoiceNumber" value="F-2025-001" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date de facture</label>
                            <input type="date" class="form-input" id="invoiceDate" required>
                        </div>
                    </div>

                    <!-- Client Information -->
                    <div style="border: 2px solid var(--border); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üë§ Informations client</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Nom du client</label>
                                <input type="text" class="form-input" id="clientName" placeholder="Nom ou raison sociale" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="clientEmail" placeholder="client@email.com" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Adresse</label>
                            <input type="text" class="form-input" id="clientAddress" placeholder="Adresse compl√®te" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Num√©ro de t√©l√©phone</label>
                                <input type="tel" class="form-input" id="clientPhone" placeholder="+33 1 23 45 67 89">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date d'√©ch√©ance</label>
                                <input type="date" class="form-input" id="invoiceDueDate" required>
                            </div>
                        </div>
                    </div>

                    <!-- Services / Products -->
                    <div style="border: 2px solid var(--border); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 1rem; font-size: 1.125rem;">üì¶ Prestations / Produits</h3>
                        <div id="invoiceLines">
                            <!-- Line 1 -->
                            <div class="invoice-line" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 0.75rem; margin-bottom: 0.75rem; align-items: end;">
                                <div class="form-group">
                                    <label class="form-label">Description</label>
                                    <input type="text" class="form-input" placeholder="D√©tailler prestation ici" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Prix unitaire HT</label>
                                    <input type="number" class="form-input line-price" placeholder="0.00" step="0.01" required oninput="calculateLineTotal(this)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Unit√©</label>
                                    <select class="form-select">
                                        <option>heures</option>
                                        <option>jours</option>
                                        <option>unit√©</option>
                                        <option>forfait</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Quantit√©</label>
                                    <input type="number" class="form-input line-quantity" placeholder="1" step="0.01" required oninput="calculateLineTotal(this)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Montant HT</label>
                                    <input type="text" class="form-input line-total" placeholder="0.00 ‚Ç¨" readonly style="background: var(--bg-light);">
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline" onclick="addInvoiceLine()" style="margin-top: 0.5rem;">+ Ajouter une ligne</button>
                    </div>

                    <!-- Totals -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div>
                            <div class="form-group">
                                <label class="form-label">Modalit√©s et conditions de r√®glement</label>
                                <textarea class="form-textarea" id="paymentTerms" placeholder="Ex: Paiement √† 30 jours, virement bancaire">Paiement √† 30 jours par virement bancaire</textarea>
                            </div>
                        </div>
                        <div style="background: var(--bg-light); padding: 1.5rem; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; font-size: 1rem;">
                                <span>Total HT</span>
                                <span id="totalHT" style="font-weight: 600;">0.00 ‚Ç¨</span>
                            </div>
                            <div class="form-group">
                                <label class="form-label">TVA (%)</label>
                                <select class="form-select" id="tvaRate" onchange="calculateTotals()">
                                    <option value="20">20%</option>
                                    <option value="10">10%</option>
                                    <option value="5.5">5.5%</option>
                                    <option value="0">0% (Franchise en base)</option>
                                </select>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                                <span>TVA</span>
                                <span id="totalTVA" style="font-weight: 600;">0.00 ‚Ç¨</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-top: 0.75rem; border-top: 2px solid var(--border); font-size: 1.25rem; font-weight: 700;">
                                <span>Total TTC</span>
                                <span id="totalTTC" style="color: var(--primary);">0.00 ‚Ç¨</span>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">üìÑ G√©n√©rer la facture (PDF)</button>
                        <button type="button" class="btn btn-outline" onclick="previewInvoice()">üëÅÔ∏è Aper√ßu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Employee Settings Modal -->
    <div id="employeeSettingsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">‚öôÔ∏è Configuration des Employ√©s</div>
                <button class="modal-close" onclick="closeEmployeeSettingsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Add Employee Button -->
                <button class="btn btn-primary" onclick="showAddEmployeeForm()" style="margin-bottom: 1.5rem; width: 100%;">
                    + Ajouter un employ√©
                </button>

                <!-- Add Employee Form (hidden by default) -->
                <div id="addEmployeeForm" style="display: none; background: var(--bg-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; font-weight: 600;">Nouvel employ√©</h3>
                    <form onsubmit="saveEmployeeSettings(event)">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Nom complet *</label>
                                <input type="text" id="empName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Poste</label>
                                <input type="text" id="empPosition" class="form-input">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Heure d'arriv√©e pr√©vue *</label>
                                <input type="time" id="empStartTime" class="form-input" value="09:00" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Heure de d√©part pr√©vue *</label>
                                <input type="time" id="empEndTime" class="form-input" value="18:00" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Jours de travail</label>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="1" checked> Lun
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="2" checked> Mar
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="3" checked> Mer
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="4" checked> Jeu
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="5" checked> Ven
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="6"> Sam
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" class="empWorkDays" value="0"> Dim
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tol√©rance retard (minutes)</label>
                            <input type="number" id="empLateTolerance" class="form-input" value="10" min="0">
                        </div>

                        <div style="display: flex; gap: 1rem;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">Enregistrer</button>
                            <button type="button" class="btn btn-outline" onclick="hideAddEmployeeForm()" style="flex: 1;">Annuler</button>
                        </div>
                    </form>
                </div>

                <!-- Employees List -->
                <div class="card">
                    <div class="card-title">Liste des employ√©s configur√©s</div>
                    <table class="data-table" style="margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Poste</th>
                                <th>Horaires</th>
                                <th>Jours</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employeeSettingsList">
                            <tr>
                                <td colspan="5" style="text-align: center; color: var(--text-gray);">Aucun employ√© configur√©</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ajouter un utilisateur</div>
                <button class="modal-close" onclick="hideAddUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">Nom complet</label>
                        <input type="text" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Niveau d'acc√®s</label>
                        <select class="form-select" required>
                            <option value="">S√©lectionner...</option>
                            <option value="admin">Admin - Acc√®s complet</option>
                            <option value="comptable">Comptable - Factures, tr√©sorerie, fiscalit√©</option>
                            <option value="consultation">Consultation - Lecture seule</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Ajouter</button>
                </form>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // NUMMA Dashboard v3.0 - FEC Edition - Updated 2026-01-14
        console.log('NUMMA Dashboard loading...');
        
        // Configuration
        const API_BASE = 'https://optimis-fiscale-production.up.railway.app';
        let currentUser = {
            name: 'Jean Dupont',
            company: 'Entreprise ABC',
            accessLevel: 'admin' // admin, comptable, consultation
        };

        // Initialize
        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateEl = document.getElementById('currentDate');
            if (dateEl) dateEl.textContent = now.toLocaleDateString('fr-FR', options);
        }

        // Switch view
        function switchView(view) {
            console.log('switchView called with:', view);
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${view}'`)) {
                    item.classList.add('active');
                }
            });

            // Update page title
            const titles = {
                'dashboard': 'Tableau de bord',
                'tresorerie': 'Tr√©sorerie',
                'factures': 'Factures',
                'rh': 'RH & Paie',
                'pointage': 'Pointage',
                'planning': 'Planning',
                'import': 'Import',
                'alertes': 'Alertes',
                'analyse': 'Analyse fiscale',
                'espace-client': 'Espace client',
                'fec': 'FEC / Comptabilit√©'
            };
            const titleEl = document.getElementById('pageTitle');
            if (titleEl) titleEl.textContent = titles[view] || 'Dashboard';

            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));

            // Show selected view
            const viewMap = {
                'dashboard': 'viewDashboard',
                'tresorerie': 'viewTresorerie',
                'factures': 'viewFactures',
                'rh': 'viewRH',
                'pointage': 'viewPointage',
                'planning': 'viewPlanning',
                'import': 'viewImport',
                'alertes': 'viewAlertes',
                'analyse': 'viewAnalyse',
                'espace-client': 'viewEspaceClient',
                'fec': 'viewFEC'
            };

            const viewId = viewMap[view];
            if (viewId) {
                const viewEl = document.getElementById(viewId);
                if (viewEl) {
                    viewEl.classList.remove('hidden');
                    console.log('Switched to view:', viewId);
                } else {
                    console.error('View element not found:', viewId);
                }
            }
        }
        
        console.log('switchView function defined:', typeof switchView);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== NUMMA DASHBOARD LOADING ===');
            console.log('Current URL:', window.location.href);
            
            updateCurrentDate();
            initChart();
            loadNotifications();
            
            // Check auth token
            const token = localStorage.getItem('authToken');
            console.log('Auth token:', token);
            
            if (!token) {
                console.log('‚ùå No token found, redirecting to login');
                window.location.href = 'login.html';
                return;
            }
            
            console.log('‚úÖ Token found:', token);
            
            // Load user data
            const userData = localStorage.getItem('currentUser');
            console.log('User data:', userData);
            
            if (userData) {
                const user = JSON.parse(userData);
                currentUser = user;
                
                console.log('‚úÖ User loaded:', user.company_name);
                
                if (user.company_name) {
                    document.getElementById('userCompany').textContent = user.company_name;
                }
                if (user.contact_name) {
                    document.getElementById('userName').textContent = user.contact_name;
                } else if (user.name) {
                    document.getElementById('userName').textContent = user.name;
                }
            } else {
                console.log('‚ö†Ô∏è No user data found');
            }
            
            checkAccessLevel();
            console.log('=== DASHBOARD LOADED ===');
        });


        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('tresorerieChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['14 D√©c', '15 D√©c', '16 D√©c', '17 D√©c', '18 D√©c', '19 D√©c', '20 D√©c'],
                    datasets: [{
                        label: 'Tr√©sorerie',
                        data: [45000, 46200, 45800, 47000, 46500, 47800, 48250],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Load notifications based on company type and date
        function loadNotifications() {
            const now = new Date();
            const day = now.getDate();
            const notificationsList = document.getElementById('notificationsList');
            
            // Get company info
            const tvaRegime = document.getElementById('tvaPeriod')?.value || 'mensuelle';
            
            // Add automatic notifications based on date
            let notifications = [];
            
            // TVA notification (21st or 24th depending on regime)
            if (tvaRegime === 'trimestrielle' && day >= 20 && day <= 24) {
                notifications.push({
                    type: 'danger',
                    title: '‚ö†Ô∏è TVA trimestrielle',
                    text: 'D√©claration TVA √† soumettre avant le 24 de ce mois',
                    date: 'Urgent'
                });
            } else if (tvaRegime === 'mensuelle' && day >= 17 && day <= 21) {
                notifications.push({
                    type: 'danger',
                    title: '‚ö†Ô∏è TVA mensuelle',
                    text: 'D√©claration TVA √† soumettre avant le 21 de ce mois',
                    date: 'Urgent'
                });
            }
            
            // Keep existing notifications
            // (would load from backend in production)
        }

        // Check access level and hide/show sections
        function checkAccessLevel() {
            const accessLevel = currentUser.accessLevel;
            
            // Update badge
            const badge = document.getElementById('userAccessLevel');
            const accessLabels = {
                'admin': 'Admin',
                'comptable': 'Comptable',
                'consultation': 'Consultation'
            };
            badge.textContent = accessLabels[accessLevel];
            
            // Show/hide user management section
            const userMgmt = document.getElementById('userManagementSection');
            if (accessLevel !== 'admin' && userMgmt) {
                userMgmt.style.display = 'none';
            }
            
            // Disable editing for consultation users
            if (accessLevel === 'consultation') {
                document.querySelectorAll('.form-input, .form-select').forEach(input => {
                    input.disabled = true;
                });
                document.querySelectorAll('.btn-primary').forEach(btn => {
                    btn.style.display = 'none';
                });
            }
        }

        // Modal functions
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('active');
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.remove('active');
        }

        function editUser(userId) {
            showInfo('Modifier utilisateur', '√âdition du profil #' + userId);
        }

        // Logout
        function handleLogout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                // Redirect to login
                window.location.href = 'login.html';
            }
        }

        // Save client info
        document.getElementById('clientInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            showSuccess('Sauvegard√©', 'Informations enregistr√©es');
        });

        // Add user
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();
            showMessage('users', 'invited', 'Utilisateur ajout√©', 'Invitation envoy√©e');
            hideAddUserModal();
        });

        // Invoice functions
        function showCreateInvoiceModal() {
            document.getElementById('createInvoiceModal').classList.add('active');
        }

        function hideCreateInvoiceModal() {
            document.getElementById('createInvoiceModal').classList.remove('active');
        }

        function filterInvoices() {
            console.log('Filtering invoices...');
        }

        function viewInvoice(id) {
            showInfo('Facture #' + id, 'Chargement des d√©tails...');
        }

        document.getElementById('createInvoiceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const client = document.getElementById('invoiceClient').value;
            showMessage('invoices', 'created', 'Facture cr√©√©e', 'Client: ' + client);
            hideCreateInvoiceModal();
        });

        // Cashflow functions
        function updateCashflowChart() {
            const period = parseInt(document.getElementById('cashflowPeriod').value);
            console.log('üìä Mise √† jour graphique:', period, 'jours');
            const canvas = document.getElementById('cashflowFullChart');
            if (!canvas) return;
            if (window.cashflowChartInstance) window.cashflowChartInstance.destroy();
            const data = generateCashflowData(period);
            const ctx = canvas.getContext('2d');
            window.cashflowChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Tr√©sorerie (‚Ç¨)',
                        data: data.values,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '‚Ç¨ ' + context.parsed.y.toLocaleString('fr-FR');
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '‚Ç¨ ' + value.toLocaleString('fr-FR');
                                }
                            }
                        }
                    }
                }
            });
            if (typeof showSuccess === 'function') showSuccess('Graphique mis √† jour', period + ' jours');
        }

        function generateCashflowData(days) {
            const labels = [], values = [], baseValue = 45000, today = new Date();
            let points = days <= 30 ? days : days <= 90 ? 14 : 30;
            const interval = Math.floor(days / points);
            for (let i = 0; i <= points; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - (days - (i * interval)));
                labels.push(date.getDate() + ' ' + date.toLocaleDateString('fr-FR', { month: 'short' }));
                values.push(Math.round(baseValue + Math.sin(i * 0.5) * 2000 + (i * 100)));
            }
            return { labels, values };
        }

        function refreshCashflow() {
            showMessage('generic', 'loading', 'Actualisation', 'Chargement...');
        }

        function filterTransactions() {
            console.log('Filtering transactions...');
        }

        function exportCSV() {
            showMessage('exports', 'processing', 'Export CSV', 'G√©n√©ration en cours...');
        }

        function exportPDF() {
            showMessage('exports', 'processing', 'Export PDF', 'G√©n√©ration en cours...');
        }

        function exportExcel() {
            showMessage('exports', 'processing', 'Export Excel', 'G√©n√©ration en cours...');
        }

        // Initialize forecast chart
        function initForecastChart() {
            const ctx = document.getElementById('forecastChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                    datasets: [{
                        label: 'Pr√©vision',
                        data: [48250, 49100, 50800, 52100],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderDash: [5, 5],
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Initialize full cashflow chart
        function initCashflowFullChart() {
            const ctx = document.getElementById('cashflowFullChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1 D√©c', '5 D√©c', '10 D√©c', '15 D√©c', '20 D√©c', '25 D√©c', '30 D√©c'],
                    datasets: [{
                        label: 'Solde',
                        data: [42000, 44500, 43800, 46200, 47500, 46800, 48250],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        // Import functions
        function handleBankUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('bankUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                const recordCount = fileType === 'PDF' ? 'Extraction en cours...' : '30 transactions';
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${recordCount} import√©es depuis ${file.name} (${fileType})</div></div>`;
                
                // Add to history
                addToImportHistory('Transactions bancaires', file.name, fileType, recordCount);
            }
        }

        function handleSalesUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('salesUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                const recordCount = fileType === 'PDF' ? 'Extraction en cours...' : '25 factures';
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${recordCount} import√©es depuis ${file.name} (${fileType})</div></div>`;
                
                addToImportHistory('Factures de vente', file.name, fileType, recordCount);
            }
        }

        function handlePurchaseUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('purchaseUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                const recordCount = fileType === 'PDF' ? 'Extraction en cours...' : '18 factures';
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${recordCount} import√©es depuis ${file.name} (${fileType})</div></div>`;
                
                addToImportHistory('Factures fournisseurs', file.name, fileType, recordCount);
            }
        }

        function handleTrialBalanceUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const status = document.getElementById('trialBalanceUploadStatus');
                status.classList.remove('hidden');
                const fileType = file.name.split('.').pop().toUpperCase();
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Analyse en cours</div><div class="notification-text">Balance comptable import√©e (${fileType}). Analyse fiscale disponible.</div></div>`;
                
                addToImportHistory('Balance comptable', file.name, fileType, '1 fichier');
                
                setTimeout(() => {
                    switchView('analyse');
                }, 2000);
            }
        }

        function handleGeneralDocsUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                const status = document.getElementById('generalDocsUploadStatus');
                status.classList.remove('hidden');
                const fileList = Array.from(files).map(f => f.name).join(', ');
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${files.length} fichier(s) import√©(s): ${fileList}</div></div>`;
                
                for (let file of files) {
                    const fileType = file.name.split('.').pop().toUpperCase();
                    addToImportHistory('Documents divers', file.name, fileType, '1 fichier');
                }
            }
        }

        function handleTaxDocsUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                const status = document.getElementById('taxDocsUploadStatus');
                status.classList.remove('hidden');
                const fileList = Array.from(files).map(f => f.name).join(', ');
                status.innerHTML = `<div class="notification-item info"><div class="notification-title">‚úì Upload r√©ussi</div><div class="notification-text">${files.length} document(s) fiscal(ux) import√©(s)</div></div>`;
                
                for (let file of files) {
                    const fileType = file.name.split('.').pop().toUpperCase();
                    addToImportHistory('Documents fiscaux', file.name, fileType, '1 document');
                }
            }
        }

        function addToImportHistory(type, filename, format, records) {
            const table = document.getElementById('importHistoryTable');
            if (!table) return;
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
            
            const badgeColors = {
                'CSV': 'background: #dbeafe; color: #1e40af;',
                'PDF': 'background: #fee2e2; color: #991b1b;',
                'XLSX': 'background: #d1fae5; color: #065f46;',
                'DOC': 'background: #fef3c7; color: #92400e;',
                'DOCX': 'background: #fef3c7; color: #92400e;'
            };
            
            const row = `
                <tr>
                    <td>${dateStr}</td>
                    <td>${type}</td>
                    <td>${filename}</td>
                    <td><span class="badge" style="${badgeColors[format] || ''}">${format}</span></td>
                    <td>${records}</td>
                    <td><span class="badge badge-success">R√©ussi</span></td>
                    <td><button class="btn btn-outline" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;" onclick="viewImportDetails()">Voir</button></td>
                </tr>
            `;
            
            table.insertAdjacentHTML('afterbegin', row);
        }

        function viewImportDetails(id) {
            showInfo('Import #' + (id || 'nouveau'), 'Affichage des d√©tails');
        }

        function downloadSampleBalance() {
            const csvContent = `account,label,debit,credit
701,VENTES DE PRODUITS FINIS,0,100000
6061,ACHATS MATIERES,40000,0
611,SOUS-TRAITANCE GENERALE,10000,0
623,PUBLICITE,5000,0
635,IMPOTS ET TAXES,3000,0
641,REMUNERATIONS DU PERSONNEL,25000,0
645,CHARGES SOCIALES,12000,0
681,DOTATIONS AUX AMORTISSEMENTS,5000,0
44571,TVA COLLECTEE,0,20000
44566,TVA DEDUCTIBLE,15000,0
512,BANQUES,50000,0
411,CLIENTS,30000,0
401,FOURNISSEURS,0,20000`;
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'exemple_balance_comptable.csv';
            link.click();
        }

        // Alert functions
        function filterAlerts() {
            console.log('Filtering alerts...');
        }

        function markAllAlertsRead() {
            if (confirm('Marquer toutes les alertes comme lues ?')) {
                showSuccess('Alertes lues', 'Toutes marqu√©es comme lues');
            }
        }

        // Tax analysis chart
        function initTaxBreakdownChart() {
            const ctx = document.getElementById('taxBreakdownChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['TVA', 'IS', 'Charges sociales', 'Autres'],
                    datasets: [{
                        data: [16800, 18500, 28200, 2400],
                        backgroundColor: ['#2563eb', '#8b5cf6', '#f59e0b', '#64748b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                                               legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Initialize all charts when views are loaded
        function initAllCharts() {
            setTimeout(() => {
                initForecastChart();
                initCashflowFullChart();
                initTaxBreakdownChart();
            }, 100);
        }

        // Call on page load
        initAllCharts();

        // Planning functions
        function showAddTaskModal() {
            showInfo('Nouvelle t√¢che', 'Formulaire de cr√©ation de t√¢che');
        }

        function showTaskDetails(taskId) {
            showInfo('T√¢che #' + taskId, 'Affichage des d√©tails');
        }

        function exportPlanning() {
            showMessage('exports', 'processing', 'Export planning', 'Formats disponibles');
        }

        function syncCalendar() {
            showInfo('Synchronisation', 'Calendrier externe');
        }

        // Quick Actions functions
        function generateCompleteReport() {
            if (confirm('G√©n√©rer un rapport complet de votre situation financi√®re et fiscale ?\n\nLe rapport inclura:\n- Analyse de tr√©sorerie\n- √âtat des factures\n- Optimisations fiscales\n- Recommandations\n\nFormat: PDF')) {
                showMessage('reports', 'generating', 'Rapport en cours', 'Vous recevrez un email');
            }
        }

        function contactExpert() {
            if (confirm('Contacter un expert-comptable ?\n\nUn expert NUMMA vous contactera dans les 24h pour:\n- R√©pondre √† vos questions\n- Optimiser votre fiscalit√©\n- Accompagner votre d√©veloppement')) {
                // Show contact form or redirect
                showMessage('contact', 'expert', 'Demande envoy√©e', 'Un expert vous contactera dans les 24h');
            }
        }

        function planOptimization() {
            // Switch to planning view and suggest creating optimization task
            switchView('planning');
            setTimeout(() => {
                if (confirm('Cr√©er une t√¢che "Optimisation fiscale 2024" ?\n\nCette t√¢che vous guidera dans:\n- L\'analyse de vos charges d√©ductibles\n- La r√©vision des amortissements\n- L\'identification des cr√©dits d\'imp√¥t\n- La planification de fin d\'ann√©e')) {
                    showMessage('tasks', 'created', 'T√¢che cr√©√©e', 'Optimisation fiscale 2024');
                }
            }, 500);
        }

        // Alert handling functions
        function handleTVADeclaration() {
            if (confirm('Commencer la d√©claration TVA T4 2024 ?\n\nVous serez guid√© pour:\n1. V√©rifier les montants collect√©s et d√©ductibles\n2. Remplir le formulaire CA3\n3. T√©l√©transmettre la d√©claration\n\n√âch√©ance: 24 janvier 2025')) {
                showInfo('D√©claration TVA', 'Documents n√©cessaires: Relev√©s, Factures');
                // In production, this would open the TVA declaration wizard
            }
        }

        function filterAlerts() {
            const type = document.getElementById('filterAlertType').value;
            const priority = document.getElementById('filterAlertPriority').value;
            console.log('Filtering alerts:', type, priority);
            // In production, this would filter the alerts list
        }

        // Task filtering function
        function filterTasks(filter) {
            console.log('Filtering tasks:', filter);
            
            // Update tab styling
            const tabs = document.querySelectorAll('#viewPlanning .btn');
            tabs.forEach(tab => {
                tab.style.borderBottomColor = 'transparent';
                tab.style.color = 'var(--text-gray)';
                tab.style.fontWeight = 'normal';
            });
            
            event.target.style.borderBottomColor = 'var(--primary)';
            event.target.style.color = 'var(--primary)';
            event.target.style.fontWeight = '600';
            
            // In production, this would filter the task list based on status
            showInfo('Filtre appliqu√©', 'Filtre: ' + filter);
        }

        // RH Functions
        function showAddEmployeeModal() {
            showInfo('Nouvel employ√©', 'Formulaire de cr√©ation');
        }

        function viewEmployee(id) {
            showInfo('Employ√© #' + id, 'Informations compl√®tes');
        }

        function generatePayslip(employeeId) {
            if (confirm('G√©n√©rer la fiche de paie de janvier 2025 pour cet employ√© ?')) {
                showMessage('payslips', 'generating', 'Fiche de paie', 'G√©n√©ration PDF...');
                // In production, would call API to generate payslip PDF
            }
        }

        function generateAllPayslips() {
            if (confirm('G√©n√©rer toutes les fiches de paie de janvier 2025 ?\n\n5 fiches seront cr√©√©es.')) {
                showMessage('payslips', 'batch_generated', '5 fiches cr√©√©es', 'Email envoy√©');
            }
        }

        function downloadPayslip(id) {
            showMessage('payslips', 'downloaded', 'T√©l√©chargement', 'Fiche #' + id);
            // In production, would download the PDF
        }

        function exportDSN() {
            if (confirm('Exporter la D√©claration Sociale Nominative (DSN) ?\n\nFichier au format requis par l\'URSSAF.')) {
                showMessage('payroll', 'dsn_exported', 'Export DSN', 'Fichier g√©n√©r√©');
            }
        }

        function calculateCharges() {
            showInfo('Charges sociales', 'Masse: ‚Ç¨ 8,500\nCharges: ‚Ç¨ 3,400 (40%)');
        }

        function manageLeaves() {
            showInfo('Gestion des cong√©s', 'Fonctionnalit√©s de gestion');
        }

        // Invoice Functions
        function showCreateInvoiceModal() {
            document.getElementById('createInvoiceModal').classList.add('active');
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            // Set due date (30 days from now)
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('invoiceDueDate').value = dueDate.toISOString().split('T')[0];
            
            // Auto-increment invoice number
            const lastNumber = localStorage.getItem('lastInvoiceNumber') || 0;
            const newNumber = parseInt(lastNumber) + 1;
            document.getElementById('invoiceNumber').value = `F-2025-${String(newNumber).padStart(3, '0')}`;
        }

        function hideCreateInvoiceModal() {
            document.getElementById('createInvoiceModal').classList.remove('active');
        }

        function addInvoiceLine() {
            const container = document.getElementById('invoiceLines');
            const newLine = document.createElement('div');
            newLine.className = 'invoice-line';
            newLine.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 0.75rem; margin-bottom: 0.75rem; align-items: end;';
            newLine.innerHTML = `
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="D√©tailler prestation ici" required>
                </div>
                <div class="form-group">
                    <input type="number" class="form-input line-price" placeholder="0.00" step="0.01" required oninput="calculateLineTotal(this)">
                </div>
                <div class="form-group">
                    <select class="form-select">
                        <option>heures</option>
                        <option>jours</option>
                        <option>unit√©</option>
                        <option>forfait</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-input line-quantity" placeholder="1" step="0.01" required oninput="calculateLineTotal(this)">
                </div>
                <div class="form-group">
                    <input type="text" class="form-input line-total" placeholder="0.00 ‚Ç¨" readonly style="background: var(--bg-light);">
                </div>
            `;
            container.appendChild(newLine);
        }

        function calculateLineTotal(input) {
            const line = input.closest('.invoice-line');
            const price = parseFloat(line.querySelector('.line-price').value) || 0;
            const quantity = parseFloat(line.querySelector('.line-quantity').value) || 0;
            const total = price * quantity;
            line.querySelector('.line-total').value = total.toFixed(2) + ' ‚Ç¨';
            calculateTotals();
        }

        function calculateTotals() {
            let totalHT = 0;
            document.querySelectorAll('.line-price').forEach((priceInput, index) => {
                const price = parseFloat(priceInput.value) || 0;
                const quantity = parseFloat(document.querySelectorAll('.line-quantity')[index].value) || 0;
                totalHT += price * quantity;
            });
            
            const tvaRate = parseFloat(document.getElementById('tvaRate').value) || 0;
            const totalTVA = totalHT * (tvaRate / 100);
            const totalTTC = totalHT + totalTVA;
            
            document.getElementById('totalHT').textContent = totalHT.toFixed(2) + ' ‚Ç¨';
            document.getElementById('totalTVA').textContent = totalTVA.toFixed(2) + ' ‚Ç¨';
            document.getElementById('totalTTC').textContent = totalTTC.toFixed(2) + ' ‚Ç¨';
        }

        function generateInvoice(event) {
            event.preventDefault();
            
            // Get company info from localStorage
            const userData = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const companyInfo = {
                name: document.getElementById('companyName')?.value || userData.company_name || 'Entreprise ABC',
                address: document.getElementById('companyAddress')?.value || '123 Rue de la R√©publique, 75001 Paris',
                siret: document.getElementById('companySIRET')?.value || '123 456 789 00012',
                email: document.getElementById('companyEmail')?.value || 'contact@entreprise.fr',
                phone: document.getElementById('companyPhone')?.value || '+33 1 23 45 67 89',
                iban: document.getElementById('companyIBAN')?.value || 'FR76 1234 5678 9012 3456 7890 123'
            };
            
            // Get form data
            const invoiceData = {
                number: document.getElementById('invoiceNumber').value,
                date: document.getElementById('invoiceDate').value,
                dueDate: document.getElementById('invoiceDueDate').value,
                client: {
                    name: document.getElementById('clientName').value,
                    address: document.getElementById('clientAddress').value,
                    email: document.getElementById('clientEmail').value,
                    phone: document.getElementById('clientPhone').value
                },
                lines: [],
                paymentTerms: document.getElementById('paymentTerms').value,
                totalHT: document.getElementById('totalHT').textContent,
                totalTVA: document.getElementById('totalTVA').textContent,
                totalTTC: document.getElementById('totalTTC').textContent
            };
            
            // Get all invoice lines
            document.querySelectorAll('.invoice-line').forEach(line => {
                invoiceData.lines.push({
                    description: line.querySelectorAll('input')[0].value,
                    price: line.querySelector('.line-price').value,
                    unit: line.querySelector('select').value,
                    quantity: line.querySelector('.line-quantity').value,
                    total: line.querySelector('.line-total').value
                });
            });
            
            // Save invoice number
            const invoiceNum = parseInt(invoiceData.number.split('-')[2]);
            localStorage.setItem('lastInvoiceNumber', invoiceNum);
            
            // Generate PDF (in production)
            showMessage('invoices', 'created', 'Facture ' + invoiceData.number, 'Client: ' + invoiceData.client.name);
            
            hideCreateInvoiceModal();
            
            // Refresh invoices list
            if (typeof loadInvoices === 'function') {
                loadInvoices();
            }
        }

        function previewInvoice() {
            showInfo('Aper√ßu facture', 'Pr√©visualisation PDF');
        }

        document.getElementById('createInvoiceForm').addEventListener('submit', generateInvoice);
    
        // ==================== CLOCK-IN FUNCTIONS ====================
        
        function updateLiveClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const dateStr = now.toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            const clockEl = document.getElementById('liveClock');
            const dateEl = document.getElementById('liveDate');
            if (clockEl) clockEl.textContent = timeStr;
            if (dateEl) dateEl.textContent = dateStr;
        }
        
        setInterval(updateLiveClock, 1000);
        updateLiveClock();
        
        // Load employee settings and populate selector
        function loadEmployeeSettings() {
            const employees = JSON.parse(localStorage.getItem('numma_employees') || '[]');
            const select = document.getElementById('clockEmployeeSelect');
            const filterSelect = document.getElementById('employeeFilter');
            
            if (select) {
                select.innerHTML = '<option value="">-- Choisir un employ√© --</option>';
                employees.forEach(emp => {
                    select.innerHTML += `<option value="${emp.name}">${emp.name} - ${emp.position || 'Employ√©'}</option>`;
                });
            }
            
            if (filterSelect) {
                const currentOptions = filterSelect.innerHTML;
                if (currentOptions.includes('Tous les employ√©s')) {
                    filterSelect.innerHTML = '<option value="">Tous les employ√©s</option>';
                    employees.forEach(emp => {
                        filterSelect.innerHTML += `<option value="${emp.name}">${emp.name}</option>`;
                    });
                }
            }
            
            return employees;
        }
        
        function clockIn() {
            const now = new Date();
            const select = document.getElementById('clockEmployeeSelect');
            const employeeName = select?.value;
            
            if (!employeeName) {
                showWarning('S√©lection requise', 'Veuillez s√©lectionner un employ√©');
                return;
            }
            
            const time = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            const date = now.toLocaleDateString('fr-FR');
            const dayOfWeek = now.getDay();
            
            // Get employee settings
            const employees = JSON.parse(localStorage.getItem('numma_employees') || '[]');
            const employee = employees.find(e => e.name === employeeName);
            
            let clockData = JSON.parse(localStorage.getItem('numma_clock_data') || '[]');
            const todayClocks = clockData.filter(c => c.date === date && c.employee === employeeName);
            const lastClock = todayClocks[todayClocks.length - 1];
            
            let type = 'in';
            let message = '';
            
            if (lastClock && lastClock.type === 'in' && !lastClock.departTime) {
                // Clock out
                type = 'out';
                lastClock.departTime = time;
                lastClock.type = 'complete';
                
                const arrivalParts = lastClock.time.split(':');
                const departParts = time.split(':');
                const arrivalMinutes = parseInt(arrivalParts[0]) * 60 + parseInt(arrivalParts[1]);
                const departMinutes = parseInt(departParts[0]) * 60 + parseInt(departParts[1]);
                const durationMinutes = departMinutes - arrivalMinutes;
                const hours = Math.floor(durationMinutes / 60);
                const minutes = durationMinutes % 60;
                lastClock.duration = `${hours}h${minutes.toString().padStart(2, '0')}`;
                
                localStorage.setItem('numma_clock_data', JSON.stringify(clockData));
                message = `‚úÖ D√©part enregistr√©!\n\n${employeeName}\n${date} √† ${time}\nDur√©e: ${lastClock.duration}`;
                updateClockHistoryTable();
            } else {
                // Check if employee is supposed to work today
                if (employee && employee.workDays && !employee.workDays.includes(dayOfWeek)) {
                    const confirm = window.confirm(`‚ö†Ô∏è ${employeeName} n'est pas pr√©vu(e) de travailler aujourd'hui.\n\nEnregistrer quand m√™me le pointage ?`);
                    if (!confirm) return;
                }
                
                const newClock = {
                    employee: employeeName,
                    date: date,
                    time: time,
                    departTime: null,
                    duration: 'En cours',
                    type: 'in',
                    timestamp: now.getTime(),
                    expectedStart: employee?.startTime || '09:00',
                    expectedEnd: employee?.endTime || '18:00',
                    status: getArrivalStatus(time, employee)
                };
                
                clockData.push(newClock);
                localStorage.setItem('numma_clock_data', JSON.stringify(clockData));
                message = `‚úÖ Arriv√©e enregistr√©e!\n\n${employeeName}\n${date} √† ${time}`;
                updateClockHistoryTable();
            }
            
            const statusEl = document.getElementById('clockStatus');
            if (statusEl) {
                statusEl.textContent = type === 'in' ? `‚úÖ Point√© arriv√©e √† ${time}` : `‚úÖ Point√© d√©part √† ${time}`;
            }
            
            updateClockStats();
            showInfo('Information', message);
        }
        
        function getArrivalStatus(time, employee) {
            const parts = time.split(':');
            const minutes = parseInt(parts[0]) * 60 + parseInt(parts[1]);
            
            // Get expected time
            let expectedStart = '09:00';
            if (employee && employee.startTime) {
                expectedStart = employee.startTime;
            }
            
            const expectedParts = expectedStart.split(':');
            const expectedMinutes = parseInt(expectedParts[0]) * 60 + parseInt(expectedParts[1]);
            
            // Check tolerance
            const tolerance = employee?.lateTolerance || 10;
            const diff = minutes - expectedMinutes;
            
            if (diff <= tolerance) {
                return "√Ä l'heure";
            } else {
                return 'Retard';
            }
        }
        
        // ==================== EMPLOYEE SETTINGS FUNCTIONS ====================
        
        function openEmployeeSettingsModal() {
            document.getElementById('employeeSettingsModal').classList.add('active');
            loadEmployeeSettingsList();
        }
        
        function closeEmployeeSettingsModal() {
            document.getElementById('employeeSettingsModal').classList.remove('active');
            hideAddEmployeeForm();
        }
        
        function showAddEmployeeForm() {
            document.getElementById('addEmployeeForm').style.display = 'block';
        }
        
        function hideAddEmployeeForm() {
            document.getElementById('addEmployeeForm').style.display = 'none';
            document.querySelector('#addEmployeeForm form').reset();
        }
        
        function saveEmployeeSettings(event) {
            event.preventDefault();
            
            const name = document.getElementById('empName').value;
            const position = document.getElementById('empPosition').value;
            const startTime = document.getElementById('empStartTime').value;
            const endTime = document.getElementById('empEndTime').value;
            const lateTolerance = parseInt(document.getElementById('empLateTolerance').value);
            
            // Get selected work days
            const workDays = [];
            document.querySelectorAll('.empWorkDays:checked').forEach(cb => {
                workDays.push(parseInt(cb.value));
            });
            
            const employee = {
                name,
                position,
                startTime,
                endTime,
                lateTolerance,
                workDays,
                id: Date.now()
            };
            
            // Save to localStorage
            let employees = JSON.parse(localStorage.getItem('numma_employees') || '[]');
            employees.push(employee);
            localStorage.setItem('numma_employees', JSON.stringify(employees));
            
            showSuccess('Employ√© ajout√©', `${name} a √©t√© ajout√©`);
            hideAddEmployeeForm();
            loadEmployeeSettingsList();
            loadEmployeeSettings();
        }
        
        function loadEmployeeSettingsList() {
            const employees = JSON.parse(localStorage.getItem('numma_employees') || '[]');
            const tbody = document.getElementById('employeeSettingsList');
            
            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-gray);">Aucun employ√© configur√©</td></tr>';
                return;
            }
            
            const daysMap = {0: 'Dim', 1: 'Lun', 2: 'Mar', 3: 'Mer', 4: 'Jeu', 5: 'Ven', 6: 'Sam'};
            
            tbody.innerHTML = employees.map(emp => {
                const workDaysStr = emp.workDays.map(d => daysMap[d]).join(', ');
                return `
                    <tr>
                        <td><strong>${emp.name}</strong></td>
                        <td>${emp.position || '-'}</td>
                        <td>${emp.startTime} - ${emp.endTime}</td>
                        <td>${workDaysStr}</td>
                        <td>
                            <button class="btn btn-outline" onclick="deleteEmployee(${emp.id})" style="padding: 0.5rem 1rem; background: var(--danger); color: white; border: none;">
                                üóëÔ∏è Supprimer
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function deleteEmployee(id) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet employ√© ?')) return;
            
            let employees = JSON.parse(localStorage.getItem('numma_employees') || '[]');
            employees = employees.filter(e => e.id !== id);
            localStorage.setItem('numma_employees', JSON.stringify(employees));
            
            loadEmployeeSettingsList();
            loadEmployeeSettings();
            showSuccess('Employ√© supprim√©', 'L\'employ√© a √©t√© supprim√©');
        }
        
        // Initialize employee selector on page load
        setTimeout(() => {
            loadEmployeeSettings();
        }, 500);
        
        function updateClockStats() {
            const today = new Date().toLocaleDateString('fr-FR');
            const dayOfWeek = new Date().getDay();
            const clockData = JSON.parse(localStorage.getItem('numma_clock_data') || '[]');
            const todayClocks = clockData.filter(c => c.date === today && c.type === 'in');
            const employees = JSON.parse(localStorage.getItem('numma_employees') || '[]');
            
            // Count present
            const presentEmployees = new Set(todayClocks.map(c => c.employee));
            document.getElementById('presentCount').textContent = presentEmployees.size;
            
            // Count late
            const lateCount = todayClocks.filter(c => c.status === 'Retard').length;
            document.getElementById('lateCount').textContent = lateCount;
            
            // Count absent (employees who should work today but haven't clocked in)
            const expectedToday = employees.filter(emp => 
                emp.workDays && emp.workDays.includes(dayOfWeek)
            );
            const absentCount = expectedToday.length - presentEmployees.size;
            document.getElementById('absentCount').textContent = Math.max(0, absentCount);
        }
        
        function updateClockHistoryTable() {
            const clockData = JSON.parse(localStorage.getItem('numma_clock_data') || '[]');
            const table = document.getElementById('clockHistoryTable');
            if (!table) return;
            
            clockData.sort((a, b) => b.timestamp - a.timestamp);
            table.innerHTML = '';
            
            clockData.forEach(clock => {
                const expectedSchedule = clock.expectedStart && clock.expectedEnd 
                    ? `${clock.expectedStart} - ${clock.expectedEnd}`
                    : '09:00 - 18:00';
                    
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${clock.employee}</td>
                    <td>${clock.date}</td>
                    <td>${clock.time}</td>
                    <td>${clock.departTime || '--:--'}</td>
                    <td>${clock.duration || 'En cours'}</td>
                    <td style="font-size: 0.875rem; color: var(--text-gray);">${expectedSchedule}</td>
                    <td><span class="badge ${clock.status === "√Ä l'heure" ? 'badge-success' : 'badge-warning'}">${clock.status || 'Pr√©sent'}</span></td>
                `;
            });
            
            const employeeFilter = document.getElementById('employeeFilter');
            if (employeeFilter) {
                const employees = [...new Set(clockData.map(c => c.employee))];
                employeeFilter.innerHTML = '<option value="">Tous les employ√©s</option>';
                employees.forEach(emp => {
                    employeeFilter.innerHTML += `<option value="${emp}">${emp}</option>`;
                });
            }
        }
        
        function filterClocks() {
            const dateFilter = document.getElementById('dateFilter')?.value;
            const employeeFilter = document.getElementById('employeeFilter')?.value;
            const table = document.getElementById('clockHistoryTable');
            
            if (!table) return;
            
            for (let i = 0; i < table.rows.length; i++) {
                const row = table.rows[i];
                let show = true;
                
                if (employeeFilter && row.cells[0].textContent !== employeeFilter) {
                    show = false;
                }
                
                if (dateFilter) {
                    const rowDate = row.cells[1].textContent;
                    const filterDateObj = new Date(dateFilter);
                    const filterDateStr = filterDateObj.toLocaleDateString('fr-FR');
                    if (rowDate !== filterDateStr) {
                        show = false;
                    }
                }
                
                row.style.display = show ? '' : 'none';
            }
        }
        
        function exportPointage() {
            const clockData = JSON.parse(localStorage.getItem('numma_clock_data') || '[]');
            
            if (clockData.length === 0) {
                showWarning('Aucune donn√©e', 'Aucun pointage √† exporter');
                return;
            }
            
            let csv = 'Employ√©,Date,Arriv√©e,D√©part,Dur√©e,Statut\n';
            clockData.forEach(entry => {
                csv += `"${entry.employee}","${entry.date}","${entry.time}","${entry.departTime || '--:--'}","${entry.duration || 'En cours'}","${entry.status || 'Pr√©sent'}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `pointages_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess('Export r√©ussi', 'Fichier CSV t√©l√©charg√©');
        }
        
        setTimeout(() => {
            updateClockHistoryTable();
            updateClockStats();
        }, 500);

        // ‚≠ê NUMMA v2.0 - Navigation FEC Module
        function openFECModule() {
            console.log('üßæ Navigation vers FEC Compta...');
            window.location.href = 'fec-manager.html';
        }

    </script>

   <!-- ========================================== -->
    <!-- NUMMA v3.0 - SYST√àME COMPLET -->
    <!-- ========================================== -->
    
    <!-- 1. Messages syst√®me (OBLIGATOIRE EN PREMIER) -->
    <script src="numma-messages.js"></script>
    
    <!-- 2. Module interactif -->
    <script src="numma-interactive-complete.js"></script>
    
    <!-- 3. Modules fonctionnels -->
    <script src="numma-invoices.js"></script>
    <script src="numma-employees.js"></script>
    <script src="numma-imports.js"></script>
    <script src="numma-exports.js"></script>
    <script src="numma-pointages.js"></script>
    
    <!-- 4. Loader principal (EN DERNIER) -->
    <script src="numma-loader.js"></script>

</body>
</html>
